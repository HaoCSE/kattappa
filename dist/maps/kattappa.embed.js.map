/**
 * Kattappa - A block based rich text editor with support of Images, embeds( Youtube, twitter, etc)
 * @version v0.1.2
 * @link https://github.com/brijeshb42/kattappa
 * @license MIT
 */
{"version":3,"sources":["kattappa.embed.js"],"names":["window","APP","Kattappa","Types","Blocks","Embed","oEmbedUrl","loaded","Twitter","React","createClass","displayName","getInitialState","message","id","valid","html","getDefaultProps","url","regex","loadExternalScript","console","log","twttr","widgets","load","scriptUrl","tag","document","createElement","src","async","onload","body","appendChild","componentDidMount","this","validate","match","props","exec","lastIndex","checkContent","setState","self","fetch","then","response","status","json","error","Error","statusText","render","state","className","dangerouslySetInnerHTML","__html","twitter"],"mappings":"AAAA,cAAA,SAAUA,QAER,GAAIC,KAAMD,OAAOE,aACbC,MAAQF,IAAIG,OAAOC,MAAMF,UAEzBG,UAAY,cACZC,QAAS,EAETC,QAAUC,MAAMC,aAGlBC,YAAa,UADbC,gBAAiB,WACf,OACEC,QAAS,OACTC,GAAI,GACJC,OAAO,EACPC,KAAM,KAIVC,gBAAiB,WACf,OACEC,IAAK,GACLC,MAAO,mFAIXC,mBAAoB,WAClB,GAAGb,OAKD,MAJAc,SAAQC,IAAI,uBACTtB,OAAOuB,OACRA,MAAMC,QAAQC,OAIlB,IAAIC,WAAY,oCACZC,IAAMC,SAASC,cAAc,SACjCF,KAAIG,IAAMJ,UACVC,IAAII,MAAQ,EAEZJ,IAAIK,OAAS,WACXzB,QAAS,EACNP,OAAOuB,QACRF,QAAQC,IAAI,cACZC,MAAMC,QAAQC,SAIlBzB,OAAO4B,SAASK,KAAKC,YAAYP,MAGnCQ,kBAAmB,WACjBC,KAAKC,YAGPA,SAAU,WACR,GAAIC,MAGJ,IAFAA,MAAQF,KAAKG,MAAMpB,MAAMqB,KAAKJ,KAAKG,MAAMrB,KACzCkB,KAAKG,MAAMpB,MAAMsB,UAAY,GACzBH,MAKF,MAJAF,MAAKG,MAAMG,cAAa,OACxBN,MAAKO,UACH9B,QAAS,UAIb,IAAI+B,MAAOR,IACXS,OAAMvC,UAAU8B,KAAKG,MAAMrB,KACxB4B,KAAK,SAASC,UACb,GAAIA,SAASC,QAAU,KAAOD,SAASC,OAAS,IAC9C,MAAOD,UAASE,MAEhB,IAAIC,OAAQ,GAAIC,OAAMJ,SAASK,WAE/B,MADAF,OAAMH,SAAWA,SACXG,QAEPJ,KAAK,SAASG,MACZA,KAAKjC,OACN4B,KAAKD,UACH3B,KAAM,QAAQiC,KAAKjC,KAAK,WAE1B4B,KAAKxB,wBAEP,SAAO,SAAS8B,OAChB7B,QAAQC,IAAI4B,OACZN,KAAKD,UACH9B,QAAS,iCAGfuB,KAAKO,UACH9B,QAAS,aACTC,GAAIwB,MAAM,GACVvB,OAAO,IAETqB,KAAKG,MAAMG,cAAa,IAG1BW,OAAQ,WAGN,MAFAhC,SAAQC,IAAI,QACZD,QAAQC,IAAIc,KAAKkB,OACdlB,KAAKkB,MAAMvC,MACW,KAApBqB,KAAKkB,MAAMtC,KAEVP,MAAAoB,cAEA,OAFK0B,UAAU,6BACdnB,KAAKkB,MAAMzC,SAKdJ,MAAAoB,cAAA,OACE0B,UAAU,4BACVC,yBAA0BC,OAAQrB,KAAKkB,MAAMtC,QAIjDP,MAAAoB,cAAA,OAAK0B,UAAU,eAEf,0BAGNpD,OAAMuD,QAAUlD,QAEhBP,IAAIG,OAAOC,MAAMF,MAAQA,MACzBH,OAAOE,SAAWD,KACjBD","file":"kattappa.embed.js","sourcesContent":["(function(window) {\n\n  var APP = window.Kattappa || {};\n  var Types = APP.Blocks.Embed.Types || {};\n\n  var oEmbedUrl = '/tweet?url=';\n  var loaded = false;\n\n  var Twitter = React.createClass({\n\n    getInitialState: function() {\n      return {\n        message: 'Wait',\n        id: '',\n        valid: false,\n        html: ''\n      };\n    },\n\n    getDefaultProps: function() {\n      return {\n        url: '',\n        regex: /https?\\:\\/\\/twitter\\.com\\/(?:[a-zA-Z0-9_]+)\\/(?:status)\\/([0-9]+)\\/?(.*){0,}/gi\n      };\n    },\n\n    loadExternalScript: function() {\n      if(loaded) {\n        console.log('already loaded');\n        if(window.twttr) {\n          twttr.widgets.load();\n        }\n        return;\n      }\n      var scriptUrl = '//platform.twitter.com/widgets.js';\n      var tag = document.createElement('script');\n      tag.src = scriptUrl;\n      tag.async = 1;\n\n      tag.onload = function() {\n        loaded = true;\n        if(window.twttr) {\n          console.log('loaded now');\n          twttr.widgets.load();\n        }\n      };\n\n      window.document.body.appendChild(tag);\n    },\n\n    componentDidMount: function() {\n      this.validate();\n    },\n\n    validate: function() {\n      var match;\n      match = this.props.regex.exec(this.props.url);\n      this.props.regex.lastIndex = 0;\n      if(!match) {\n        this.props.checkContent(false);\n        this.setState({\n          message: 'error.'\n        });\n        return;\n      }\n      var self = this;\n      fetch(oEmbedUrl+this.props.url)\n        .then(function(response) {\n          if (response.status >= 200 && response.status < 300) {\n            return response.json();\n          } else {\n            var error = new Error(response.statusText);\n            error.response = response;\n            throw error;\n          }\n        }).then(function(json) {\n          if(json.html) {\n            self.setState({\n              html: '<div>'+json.html+'</div>'\n            });\n            self.loadExternalScript();\n          }\n        }).catch(function(error) {\n          console.log(error);\n          self.setState({\n            message: 'Error while loading tweet.'\n          });\n        });\n      this.setState({\n        message: 'Loading...',\n        id: match[1],\n        valid: true\n      });\n      this.props.checkContent(true);\n    },\n\n    render: function() {\n      console.log('rndr');\n      console.log(this.state);\n      if(this.state.valid) {\n        if(this.state.html === '') {\n          return (\n            <div className=\"katap-embed katap-twitter\">\n            {this.state.message}\n            </div>\n          );\n        }\n        return (\n          <div\n            className=\"katap-embed katap-twitter\"\n            dangerouslySetInnerHTML={{__html: this.state.html}} />\n        );\n      }\n      return (\n        <div className=\"katap-embed\">Invalid twitter URL.</div>\n      );\n    }\n  });\n  \n  Types.twitter = Twitter;\n  \n  APP.Blocks.Embed.Types = Types\n  window.Kattappa = APP;\n})(window);\n"],"sourceRoot":"/source/"}
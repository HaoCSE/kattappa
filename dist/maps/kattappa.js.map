/**
 * Kattappa - A block based rich text editor with support of Images, embeds( Youtube, twitter, etc)
 * @version v0.2.0
 * @link https://github.com/brijeshb42/kattappa
 * @license MIT
 */
{"version":3,"sources":["kattappa.js"],"names":["window","Quill","React","Error","initializeTouchEvents","APP","Kattappa","BlockStructure","Text","Image","Quote","UL","content","key","OL","Embed","H2","uuid","s4","Math","floor","random","toString","substring","Keys","ENTER","ESC","BACKSPACE","Action","UP","DOWN","REMOVE","Blocks","QuillEnterHandler","quill","options","this","enterKey","require","KEYS","keyup","editor","root","addEventListener","event","keyCode","preventDefault","stopPropagation","call","keydown","registerModule","BlockText","createClass","displayName","captureReturn","props","addBlock","position","onContentChanged","render","createElement","className","QuillComponent","Name","Icon","Empty","Description","isEmpty","replace","BlockQuote","credit","onCreditChange","e","target","value","type","placeholder","onChange","console","log","BlockTypes","HR","Droppable","getInitialState","getDefaultProps","supportClick","multiple","getClassName","state","componentDidMount","refs","droppable","getDOMNode","focus","onDragOver","dataTransfer","dropEffect","effectAllowed","setState","onDragLeave","onClick","fileInput","findDOMNode","input","click","onDrop","files","maxFiles","length","i","preview","URL","createObjectURL","Array","prototype","slice","ref","style","display","children","UploadUrl","BlockImage","message","handleImage","self","file","indexOf","alert","data","FormData","append","fetch","method","credentials","body","then","response","status","json","error","statusText","src","LI","addItem","push","handleItemRemove","action","splice","renderListItem","li","map","item","index","BlockControl","onlyRemove","blockAction","getDomain","url","a","document","href","hostname","urlRegExp","loaded","domain","checkUrls","isProp","test","Types","handleUrl","checkContent","ok","renderBlock","onKeyUp","Instagram","id","valid","regex","validate","match","exec","lastIndex","frameBorder","allowFullScreen","instagram","Youtube","width","height","youtu","Vimeo","vimeo","blocks","Toolbar","visible","types","Object","keys","toggleState","nodes","currentTarget","getAttribute","title","typ","pos","handleClick","getToolbar","data-action","buttons","ExtraEnter","PropTypes","cloneElement","addons","cloneWithProps","defaultItems","label","items","onConvert","c","theme","modules","link-tooltip","enterPressed","showToolbar","createEditor","$el","config","hookEditor","on","delta","source","onEditorChange","getHTML","bind","range","onEditorChangeSelection","addModule","setEditorContents","setHTML","setSelection","getEditorContents","sel","getSelection","setEditorSelection","isControlled","getEditorConfig","pollInterval","formats","toolbar","JSON","parse","stringify","container","getEditorElement","renderItems","renderGroups","groups","visibility","Medium","MediumComponent","element","mode","inlineRichMode","tags","innerLevel","break","horizontalRule","paragraph","cssClasses","pasteHook","clear","attributes","remove","pasteAsText","initialState","Editor","blockUrl","headers","Accept","Content-Type","processData","warn","handleBlockAction","newBlocks","confirm","newBlock","contentChange","renderBlocks","rndr","block","passBlocks","onSave"],"mappings":"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","file":"kattappa.js","sourcesContent":["(function(window) {\n\n  'use strict';\n\n  var Quill = window.Quill || null;\n  var React = window.React;\n  if(!React) {\n    throw new Error('React is required for this project to function.');\n  }\n  React.initializeTouchEvents(true);\n  // if(!Quill) {\n  //   throw new Error('Quill is required for this project to function.');\n  // }\n\n  var APP = window.Kattappa || {};\n\n  APP.BlockStructure = {\n    Text: '',\n    Image: '',\n    Quote: '',\n    UL: [{\n      content: '',\n      key: ''\n    }],\n    OL: [{\n      content: '',\n      key: ''\n    }],\n    Embed: '',\n    H2: ''\n  };\n\n  APP.uuid = function guid() {\n    function s4() {\n      return Math.floor((1 + Math.random()) * 0x10000)\n        .toString(16)\n        .substring(1);\n    }\n    return s4() + '-' + s4();\n    // return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n    //   s4() + '-' + s4() + s4() + s4();\n  };\n\n  APP.Keys = {\n    ENTER: 13,\n    ESC: 27,\n    BACKSPACE: 8\n  };\n\n  APP.Action = {\n    UP: \"up\",\n    DOWN: \"down\",\n    REMOVE: \"remove\"\n  };\n\n  APP.Blocks = {};\n\n  var QuillEnterHandler = function(quill, options) {\n    //console.log('init enter handler');\n    this.quill = quill;\n    this.options = options;\n\n    var enterKey = Quill.require('dom').KEYS.ENTER;\n\n    if(options && options.keyup && typeof options.keyup === 'function') {\n      quill.editor.root.addEventListener('keyup', function(event) {\n        if(event.keyCode === enterKey) {\n          event.preventDefault();\n          event.stopPropagation();\n          options.keyup.call(null, event);\n        }\n      });\n    }\n    if(options && options.keydown && typeof options.keydown === 'function') {\n      quill.editor.root.addEventListener('keydown', function(event) {\n        if(event.keyCode === enterKey) {\n          event.preventDefault();\n          event.stopPropagation();\n          options.keydown.call(null, event);\n        }\n      });\n    }\n  };\n\n  Quill.registerModule('enterHandler', QuillEnterHandler);\n\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var BlockText = React.createClass({\n\n    captureReturn: function() {\n      this.props.addBlock(\"Text\", this.props.position);\n    },\n\n    onContentChanged: function(content) {\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    render: function() {\n      return (\n        <div className=\"katap-text\">\n          <APP.QuillComponent\n            content={this.props.content}\n            captureReturn={this.captureReturn}\n            onContentChanged={this.onContentChanged} />\n        </div>\n      );\n    }\n\n  });\n  \n  APP.Blocks.Text = {\n    Name: 'Text',\n    React: BlockText,\n    Icon: '',\n    Empty: function() {\n      return '';\n    },\n    Description: 'Text',\n    isEmpty: function(content) {\n      return (content.replace(/(<([^>]+)>)/ig,'') === '');\n    }\n  };\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var BlockQuote = React.createClass({\n\n    // focus: function() {\n    //   //this.quill.focus();\n    // },\n\n    // componentDidMount: function(){\n    //   //this.initiateEditor();\n    //   this.focus();\n    // },\n\n    captureReturn: function() {\n      this.props.addBlock(\"Text\", this.props.position);\n    },\n\n    onContentChanged: function(content) {\n      var content = {\n        content: content,\n        credit: this.props.content.credit\n      };\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    onCreditChange: function(e) {\n      var content = {\n        content: this.props.content.content,\n        credit: e.target.value\n      };\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    render: function() {\n      return (\n        <blockquote className=\"katap-text\">\n          <input\n            className=\"katap-blockquote-credit\"\n            type=\"text\"\n            placeholder=\"Credit\"\n            onChange={this.onCreditChange}\n            value={this.props.content.credit} />\n          <APP.QuillComponent\n            content={this.props.content.content}\n            captureReturn={this.captureReturn}\n            onContentChanged={this.onContentChanged} />\n        </blockquote>\n      );\n    }\n\n  });\n  \n  //APP.BlockTypes.Text = 'Text';\n  APP.Blocks.Quote = {\n    Name: 'Quote',\n    React: BlockQuote,\n    Icon: '',\n    Empty: function() {\n      return {\n        content: '',\n        credit: ''\n      };\n    },\n    Description: 'Block Quote',\n    isEmpty: function(content) {\n      return (content.replace(/(<([^>]+)>)/ig,'') === '');\n    }\n  };\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var items = [\n    {\n      label:'Text',\n      type:'group',\n      items: [\n        { type:'link', label:'Link'}\n      ]\n    }\n  ];\n\n  var H2 = React.createClass({\n\n    captureReturn: function() {\n      console.log('enter');\n      this.props.addBlock(\"Text\", this.props.position);\n    },\n\n    onContentChanged: function(content) {\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    render: function() {\n      return (\n        <h2 className=\"katap-h2\">\n          <APP.QuillComponent\n            content={this.props.content}\n            captureReturn={this.captureReturn}\n            onContentChanged={this.onContentChanged} />\n        </h2>\n      );\n    }\n\n  });\n\n  var H3 = React.createClass({\n\n    captureReturn: function() {\n      console.log('enter');\n      this.props.addBlock(\"Text\", this.props.position);\n    },\n\n    onContentChanged: function(content) {\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    render: function() {\n      return (\n        <h3 className=\"katap-h3\">\n          <APP.QuillComponent\n            content={this.props.content}\n            captureReturn={this.captureReturn}\n            onContentChanged={this.onContentChanged} />\n        </h3>\n      );\n    }\n\n  });\n\n  var H4 = React.createClass({\n\n    captureReturn: function() {\n      console.log('enter');\n      this.props.addBlock(\"Text\", this.props.position);\n    },\n\n    onContentChanged: function(content) {\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    render: function() {\n      return (\n        <h4 className=\"katap-h4\">\n          <APP.QuillComponent\n            content={this.props.content}\n            captureReturn={this.captureReturn}\n            onContentChanged={this.onContentChanged} />\n        </h4>\n      );\n    }\n\n  });\n  \n  APP.BlockTypes.Text = 'Text';\n  APP.Blocks.H2 = {\n    Name: 'H2',\n    React: H2,\n    Icon: '',\n    Empty: function() {\n      return '';\n    },\n    Description: 'Heading 2',\n    isEmpty: function(content) {\n      if(content.replace(/(<([^>]+)>)/ig,'') === '') {\n        return true;\n      }\n      return false;\n    }\n  };\n\n  // APP.Blocks.H3 = {\n  //   Name: 'H3',\n  //   React: H3,\n  //   Icon: '',\n  //   Empty: '',\n  //   isEmpty: function(content) {\n  //     if(content.replace(/(<([^>]+)>)/ig,'') === '') {\n  //       return true;\n  //     }\n  //     return false;\n  //   }\n  // };\n\n  // APP.Blocks.H4 = {\n  //   Name: 'H4',\n  //   React: H4,\n  //   Icon: '',\n  //   Empty: '',\n  //   isEmpty: function(content) {\n  //     if(content.replace(/(<([^>]+)>)/ig,'') === '') {\n  //       return true;\n  //     }\n  //     return false;\n  //   }\n  // };\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var HR = React.createClass({\n\n    render: function() {\n      return (\n        <hr className=\"katap-hr\" />\n      );\n    }\n  });\n\n  APP.Blocks.HR = {\n    Name: 'HR',\n    React: HR,\n    Icon: '',\n    Empty: function() {\n      return '';\n    },\n    Description: 'Break',\n    isEmpty: function(content) {\n      return true;\n    }\n  };\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var Droppable = React.createClass({\n    getInitialState: function() {\n      return {\n        className: ''\n      };\n    },\n\n    getDefaultProps: function() {\n      return {\n        supportClick: true,\n        multiple: false\n      };\n    },\n\n    getClassName: function() {\n      return 'katap-droppable '+(this.props.className || this.state.className);\n    },\n\n    componentDidMount: function() {\n      this.refs.droppable.getDOMNode().focus();\n    },\n\n    onDragOver: function(e) {\n      e.preventDefault();\n      e.stopPropagation();\n      e.dataTransfer.dropEffect = 'copy';\n      var effectAllowed = e.dataTransfer.effectAllowed;\n      if (effectAllowed === 'all' || effectAllowed === 'uninitialized') {\n        this.setState({\n          className: 'katap-drop-active'\n        });\n      }\n      if (this.props.onDragOver) {\n        this.props.onDragOver(e);\n      }\n    },\n\n    onDragLeave: function(e) {\n      this.setState({\n        className: ''\n      });\n\n      if (this.props.onDragLeave) {\n        this.props.onDragLeave(e);\n      }\n    },\n\n    onClick: function() {\n      var fileInput = React.findDOMNode(this.refs.input);\n      fileInput.value = null;\n      fileInput.click();\n    },\n\n    onDrop: function(e) {\n      e.preventDefault();\n      var files;\n      if(e.dataTransfer) {\n        files = e.dataTransfer.files;\n      } else if(e.target) {\n        files = e.target.files;\n      }\n      var maxFiles = (this.props.multiple) ? files.length : 1;\n      for (var i = 0; i < maxFiles; i++) {\n        files[i].preview = URL.createObjectURL(files[i]);\n      }\n      if(this.props.onDrop) {\n        files = Array.prototype.slice.call(files, 0, maxFiles);\n        //console.log(files);\n        this.props.onDrop(files);\n      }\n    },\n\n    render: function() {\n      return (\n        <div\n          ref=\"droppable\"\n          className={this.getClassName()}\n          onDragOver={this.onDragOver}\n          onDragLeave={this.onDragLeave}\n          onClick={this.onClick}\n          onDrop={this.onDrop} >\n          <input\n            ref=\"input\"\n            type=\"file\"\n            style={{display: 'none'}}\n            multiple={this.props.multiple}\n            onChange={this.onDrop} />\n          {this.props.children}\n        </div>\n      );\n    }\n  });\n\n  APP.Droppable = Droppable;\n  window.Kattappa = APP;\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var UploadUrl = \"\";\n\n  var BlockImage = React.createClass({\n\n    getInitialState: function() {\n      return {\n        message: 'Drop image here or click to add.'\n      };\n    },\n\n    handleImage: function(files) {\n      var self = this;\n      var file = files[0];\n      if(file.type.indexOf(\"image/\") !== 0) {\n        alert(\"Provide a valid image file.\");\n        return;\n      }\n      if(APP.Blocks.Image.UploadUrl !== \"\") {\n        var data = new FormData();\n        data.append(\"image\", file);\n        fetch(APP.Blocks.Image.UploadUrl, {\n          method: 'POST',\n          credentials: 'same-origin',\n          body: data\n        }).then(function(response) {\n          if(response.status >= 200 && response.status < 300) {\n            return response.json();\n          } else {\n            var error = new Error(response.statusText);\n            error.response = response;\n            throw error;\n          }\n        }).then(function(json) {\n          if(json.type && json.type === \"success\") {\n            //console.log(json);\n            if(self.props.onContentChanged) {\n              self.props.onContentChanged(self.props.position, json.message);\n            }\n          } else {\n            alert('Could not upload.');\n          }\n        }).catch(function(error) {\n          console.log(error);\n          alert('Error while uploading. Retry.');\n        });\n      } else if(this.props.onContentChanged){\n        this.props.onContentChanged(this.props.position, file.preview);\n      }\n    },\n\n    render: function() {\n      if(this.props.content === \"\") {\n        return (\n          <div className=\"katap-image\">\n            <APP.Droppable\n              onDrop={this.handleImage}>\n              <p>{this.state.message}</p>\n            </APP.Droppable>\n          </div>\n        );\n      } else {\n        return (\n          <div className=\"katap-image\">\n            <img src={this.props.content} />\n          </div>\n        );\n      }\n    }\n\n  });\n  \n  //APP.BlockTypes.Text = 'Text';\n  APP.Blocks.Image = {\n    Name: 'Image',\n    React: BlockImage,\n    Icon: '',\n    Empty: function() {\n      return '';\n    },\n    Description: 'Image',\n    UploadUrl: UploadUrl,\n    isEmpty: function(content) {\n      return (content === '');\n    }\n  };\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var Action = APP.Action;\n\n  var LI = React.createClass({\n\n    captureReturn: function() {\n      this.props.addItem(this.props.position);\n    },\n\n    onContentChanged: function(content) {\n      //console.log(content);\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    render: function() {\n      return (\n        <APP.QuillComponent\n          content={this.props.content}\n          captureReturn={this.captureReturn}\n          onContentChanged={this.onContentChanged} />\n      );\n    }\n\n  });\n\n  var UL = React.createClass({\n    onContentChanged: function(position, content) {\n      this.props.content[position].content = content;\n      this.props.onContentChanged(this.props.position, this.props.content);\n    },\n\n    addItem: function(position) {\n      if(position < 0 || position >= this.props.content.length) {\n        return;\n      }\n      var content = this.props.content;\n      content.push({\n        content: '',\n        key: APP.uuid()\n      });\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    handleItemRemove: function(action, position) {\n      console.log(position);\n      if(this.props.content.length < 2) {\n        return;\n      }\n      var content = this.props.content;\n      console.log(content);\n      content.splice(position, 1);\n      console.log(content);\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    renderListItem: function() {\n      var self = this;\n      var li = [];\n      this.props.content.map(function(item, index) {\n        li.push(\n          <li key={item.key}>\n            <APP.BlockControl\n              onlyRemove={true}\n              blockAction={self.handleItemRemove}\n              position={index}\n              length={self.props.content.length} />\n            <LI\n              position={index}\n              content={item.content}\n              addItem={self.addItem}\n              onContentChanged={self.onContentChanged} />\n          </li>\n        );\n      });\n      return li;\n    },\n\n    render: function() {\n      return (\n        <ul className=\"katap-list\">\n        {this.renderListItem()}\n        </ul>\n      );\n    }\n  });\n\n  APP.Blocks.UL = {\n    Name: 'UL',\n    React: UL,\n    Icon: '',\n    Empty: function() {\n      return [{\n        content: '',\n        key: APP.uuid()\n      }];\n    },\n    Description: 'Undordered List',\n    isEmpty: function(content) {\n      for(var i = 0; i<content.length; i++) {\n        if(content[i].content.replace(/(<([^>]+)>)/ig,'') !== '') {\n          return false\n        }\n      }\n      return true;\n    }\n  };\n\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var Action = APP.Action;\n\n  var LI = React.createClass({\n\n    captureReturn: function() {\n      this.props.addItem(this.props.position);\n    },\n\n    onContentChanged: function(content) {\n      //console.log(content);\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    render: function() {\n      return (\n        <APP.QuillComponent\n          content={this.props.content}\n          captureReturn={this.captureReturn}\n          onContentChanged={this.onContentChanged} />\n      );\n    }\n\n  });\n\n  var OL = React.createClass({\n    onContentChanged: function(position, content) {\n      this.props.content[position].content = content;\n      this.props.onContentChanged(this.props.position, this.props.content);\n    },\n\n    addItem: function(position) {\n      if(position < 0 || position >= this.props.content.length) {\n        return;\n      }\n      var content = this.props.content;\n      content.push({\n        content: '',\n        key: APP.uuid()\n      });\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    handleItemRemove: function(action, position) {\n      console.log(position);\n      if(this.props.content.length < 2) {\n        return;\n      }\n      var content = this.props.content;\n      console.log(content);\n      content.splice(position, 1);\n      console.log(content);\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    renderListItem: function() {\n      var self = this;\n      var li = [];\n      this.props.content.map(function(item, index) {\n        li.push(\n          <li key={item.key}>\n            <APP.BlockControl\n              onlyRemove={true}\n              blockAction={self.handleItemRemove}\n              position={index}\n              length={self.props.content.length} />\n            <LI\n              position={index}\n              content={item.content}\n              addItem={self.addItem}\n              onContentChanged={self.onContentChanged} />\n          </li>\n        );\n      });\n      return li;\n    },\n\n    render: function() {\n      return (\n        <ol className=\"katap-list\">\n        {this.renderListItem()}\n        </ol>\n      );\n    }\n  });\n\n  APP.Blocks.OL = {\n    Name: 'OL',\n    React: OL,\n    Icon: '',\n    Empty: function() {\n      return [{\n        content: '',\n        key: APP.uuid()\n      }];\n    },\n    Description: 'Ordered List',\n    isEmpty: function(content) {\n      for(var i = 0; i<content.length; i++) {\n        if(content[i].content.replace(/(<([^>]+)>)/ig,'') !== '') {\n          return false\n        }\n      }\n      return true;\n    }\n  };\n\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var urlRegExp =/^(?:(?:https?|ftp):\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!10(?:\\.\\d{1,3}){3})(?!127(?:\\.\\d{1,3}){3})(?!169\\.254(?:\\.\\d{1,3}){2})(?!192\\.168(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:\\/[^\\s]*)?$/i;\n  \n  function getDomain(url) {\n    var a = window.document.createElement(\"a\");\n    a.href = url;\n    return a.hostname;\n  }\n\n  var Embed = React.createClass({\n\n    getInitialState: function() {\n      return {\n        loaded: false,\n        domain: '',\n        url: ''\n      };\n    },\n\n    getDefaultProps: function() {\n      return {\n        content: ''\n      };\n    },\n\n    checkUrls: function(url, isProp){\n      if(urlRegExp.test(url)) {\n        var domain = getDomain(url);\n        for(var key in APP.Blocks.Embed.Types) {\n          if(domain.indexOf(key) > -1) {\n            this.setState({\n              loaded: true,\n              domain: key,\n              url: url\n            });\n            return;\n          }\n        }\n        alert('This URL is not supported.');\n        this.refs.getDOMNode().value = '';\n      } else {\n        if(!isProp) {\n          alert(\"Enter a valid url\");\n        }\n      }\n    },\n\n    handleUrl: function(event) {\n      if(event.keyCode === APP.Keys.ENTER) {\n        this.checkUrls(event.target.value, false);\n      }\n    },\n\n    componentDidMount: function() {\n      this.refs.input.getDOMNode().focus();\n      this.checkUrls(this.props.content, true);\n    },\n\n    checkContent: function(ok) {\n      if(ok) {\n        this.props.onContentChanged(this.props.position, this.state.url);\n      } else if(this.props.content === this.state.url) {\n      } else {\n        this.setState({\n          loaded: false\n        });\n      }\n    },\n\n    renderBlock: function() {\n      return (\n        React.createElement(APP.Blocks.Embed.Types[this.state.domain], {\n          url: this.state.url,\n          checkContent: this.checkContent\n        })\n      );\n    },\n\n    render: function() {\n      if(this.state.loaded) {\n        return this.renderBlock();\n      } else {\n        return (\n          <div className=\"katap-embed\">\n            <input\n              ref=\"input\"\n              type=\"text\"\n              placeholder=\"Enter URL and press enter\"\n              onKeyUp={this.handleUrl} />\n          </div>\n        );\n      }\n    }\n  });\n\n  APP.Blocks.Embed = {\n    Name: 'Embed',\n    React: Embed,\n    Icon: '',\n    Empty: function() {\n      return '';\n    },\n    Description: 'Embed',\n    isEmpty: function(content) {\n      return (content === '');\n    },\n    Types: {}\n  };\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n\n  var APP = window.Kattappa || {};\n  var Types = APP.Blocks.Embed.Types || {};\n\n  var Instagram = React.createClass({\n\n    getInitialState: function() {\n      return {\n        message: 'Wait',\n        id: '',\n        valid: false\n      };\n    },\n\n    getDefaultProps: function() {\n      return {\n        url: '',\n        regex: /https?:\\/\\/instagram\\.com\\/p\\/([^\\/]+)\\/?.*/gi\n      };\n    },\n\n    componentDidMount: function() {\n      this.validate();\n    },\n\n    validate: function() {\n      var match;\n      match = this.props.regex.exec(this.props.url);\n      this.props.regex.lastIndex = 0;\n      if(!match) {\n        this.props.checkContent(false);\n        this.setState({\n          message: 'error.'\n        });\n        return;\n      }\n      this.setState({\n        message: 'OK.',\n        id: match[1],\n        valid: true\n      });\n      this.props.checkContent(true);\n    },\n\n    render: function() {\n      if(this.state.valid) {\n        return (\n          <div className=\"katap-embed katap-instagram\">\n          <iframe\n          src={'//instagram.com/p/'+this.state.id+'/embed'}\n          frameBorder={0}\n          allowFullScreen={true} />\n          </div>\n          );\n      }\n      return (\n        <div className=\"katap-embed\">Invalid instagram URL.</div>\n        );\n    }\n  });\n  \n  Types.instagram = Instagram;\n  \n  APP.Blocks.Embed.Types = Types\n  window.Kattappa = APP;\n})(window);\n\n(function(window) {\n\n  var APP = window.Kattappa || {};\n  var Types = APP.Blocks.Embed.Types || {};\n\n  var Youtube = React.createClass({\n\n    getInitialState: function() {\n      return {\n        message: 'Wait',\n        id: '',\n        valid: false\n      };\n    },\n\n    getDefaultProps: function() {\n      return {\n        url: '',\n        regex: /^.*(?:(?:youtu\\.be\\/)|(?:youtube\\.com)\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=|\\&v=)([^#\\&\\?]*)/\n      };\n    },\n\n    componentDidMount: function() {\n      this.validate();\n    },\n\n    validate: function() {\n      var match;\n      match = this.props.regex.exec(this.props.url);\n      this.props.regex.lastIndex = 0;\n      if(!match) {\n        this.props.checkContent(false);\n        this.setState({\n          message: 'error.'\n        });\n        return;\n      }\n      this.setState({\n        message: 'OK.',\n        id: match[1],\n        valid: true\n      });\n      this.props.checkContent(true);\n    },\n\n    render: function() {\n      if(this.state.valid) {\n        return (\n          <div className=\"katap-embed katap-youtube\">\n          <iframe\n            src={'//youtube.com/embed/'+this.state.id}\n            frameBorder={0}\n            width={580}\n            height={320}\n            allowFullScreen={true} />\n          </div>\n        );\n      }\n      return (\n        <div className=\"katap-embed\">Invalid youtube URL.</div>\n      );\n    }\n  });\n  \n  Types.youtu = Youtube;\n  \n  APP.Blocks.Embed.Types = Types\n  window.Kattappa = APP;\n})(window);\n\n(function(window) {\n\n  var APP = window.Kattappa || {};\n  var Types = APP.Blocks.Embed.Types || {};\n\n  var Vimeo = React.createClass({\n\n    getInitialState: function() {\n      return {\n        message: 'Wait',\n        id: '',\n        valid: false\n      };\n    },\n\n    getDefaultProps: function() {\n      return {\n        url: '',\n        regex: /(?:http[s]?:\\/\\/)?(?:www.)?vimeo\\.co(?:.+(?:\\/)([^\\/].*)+$)/\n      };\n    },\n\n    componentDidMount: function() {\n      this.validate();\n    },\n\n    validate: function() {\n      var match;\n      match = this.props.regex.exec(this.props.url);\n      this.props.regex.lastIndex = 0;\n      if(!match) {\n        this.props.checkContent(false);\n        this.setState({\n          message: 'error.'\n        });\n        return;\n      }\n      this.setState({\n        message: 'OK.',\n        id: match[1],\n        valid: true\n      });\n      this.props.checkContent(true);\n    },\n\n    render: function() {\n      if(this.state.valid) {\n        return (\n          <div className=\"katap-embed katap-vimeo\">\n          <iframe\n            src={'//player.vimeo.com/video/'+this.state.id}\n            frameBorder={0}\n            width={580}\n            height={320}\n            allowFullScreen={true} />\n          </div>\n        );\n      }\n      return (\n        <div className=\"katap-embed\">Invalid vimeo URL.</div>\n      );\n    }\n  });\n  \n  Types.vimeo = Vimeo;\n  \n  APP.Blocks.Embed.Types = Types\n  window.Kattappa = APP;\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var Action = APP.Action;\n  var blocks = APP.Blocks;\n\n  var Toolbar = React.createClass({\n    getInitialState: function() {\n      return {\n        visible: false,\n        types: Object.keys(blocks)\n      };\n    },\n\n    toggleState: function(e) {\n      var nodes = Array.prototype.slice.call(e.currentTarget.children);\n      var index = nodes.indexOf( e.target );\n      if(index < 0) {\n        return;\n      }\n      this.setState({\n        visible: !this.state.visible\n      });\n      if(!this.state.visible || index === 0) {\n      } else {\n        this.props.addBlock(nodes[index].getAttribute('title'), this.props.position);\n      }\n    },\n\n    addBlock: function(type, position) {\n      this.props.addBlock()\n    },\n\n    render: function() {\n      var self = this;\n      if(!this.state.visible) {\n        return (\n          <div\n            className=\"katap-toolbar\"\n            onClick={this.toggleState}>\n            <button title=\"Add block\">+</button>\n          </div>\n        );\n      }\n      return (\n        <div\n          className=\"katap-toolbar\"\n          onClick={this.toggleState}>\n          <button title=\"Close\">&times;</button>\n          {this.state.types.map(function(typ, pos) {\n              return (\n                <button\n                  title={typ}\n                  key={pos}>\n                  {blocks[typ].Description}\n                </button>\n              );\n            })}\n        </div>\n      );\n    }\n  });\n\n  /*\n  ** Handles block positioning. Can remove a block or move it up/down as required.\n  */\n  var BlockControl = React.createClass({\n\n    getDefaultProps: function() {\n      onlyRemove: false\n    },\n\n    handleClick: function(e) {\n      //console.log(e);\n      var nodes = Array.prototype.slice.call(e.currentTarget.children);\n      var index = nodes.indexOf(e.target);\n      if(index < 0) {\n        return;\n      }\n      var action = nodes[index].getAttribute(\"data-action\");\n      this.props.blockAction(action, this.props.position);\n    },\n\n    getToolbar: function(index) {\n      // if(index === 0 && this.props.length < 2) {\n      //   return null;\n      // } \n      if(this.props.onlyRemove) {\n        return (\n          <div\n            className=\"katap-control-toolbar\"\n            onClick={this.handleClick}>\n            <button title=\"Remove\" data-action={Action.REMOVE} key={Action.REMOVE}>&times;</button>\n          </div>\n        );\n      }\n      var buttons = [];\n      if(index === 0 && this.props.length < 2) {\n        buttons.push(<button title=\"Remove\" data-action={Action.REMOVE} key={Action.REMOVE}>&times;</button>);\n      } else if(index === 0) {\n        buttons.push(<button title=\"Remove\" data-action={Action.REMOVE} key={Action.REMOVE}>&times;</button>);\n        buttons.push(<button title=\"Move Down\" data-action={Action.DOWN} key={Action.DOWN}>↓</button>);\n      } else if(index === this.props.length-1) {\n        buttons.push(<button title=\"Remove\" data-action={Action.REMOVE} key={Action.REMOVE}>&times;</button>);\n        buttons.push(<button title=\"Move Up\" data-action={Action.UP} key={Action.UP}>↑</button>);\n      } else {\n        buttons.push(<button title=\"Remove\" data-action={Action.REMOVE} key={Action.REMOVE}>&times;</button>);\n        buttons.push(<button title=\"Move Up\" data-action={Action.UP} key={Action.UP}>↑</button>);\n        buttons.push(<button title=\"Move Down\" data-action={Action.DOWN} key={Action.DOWN}>↓</button>);\n      }\n      return (\n        <div\n          className=\"katap-control-toolbar\"\n          onClick={this.handleClick}>\n          {buttons}\n        </div>\n      );\n    },\n\n    render: function() {\n      return this.getToolbar(this.props.position);\n    }\n  });\n\n  APP.Toolbar = Toolbar;\n  APP.BlockControl = BlockControl;\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n  var T = React.PropTypes;\n\n  var ExtraEnter = \"<div><br></div>\";\n\n  if (React.cloneElement) {\n    var cloneElement = React.cloneElement;\n  } else if (React.addons && React.addons.cloneWithProps) {\n    var cloneElement = React.addons.cloneWithProps;\n  } else {\n    throw new Error('React addons are required when using React 0.12 or less.');\n  }\n\n  var defaultItems = [\n    {\n      label:'Text',\n      type:'group',\n      items: [\n        { type:'bold', label:'Bold'},\n        { type:'italic', label:'Italic'},\n        //{ type:'underline', label:'Underline'},\n        { type:'link', label:'Link'}\n      ]\n    }\n  ];\n\n  /*\n  * Quill Component\n  */\n\n  var QuillComponent = React.createClass({\n\n    onConvert: function(c) {\n      console.log(c);\n      console.log(c.replace(/(<([^>]+)>)/ig,\"\"));\n    },\n\n    getDefaultProps: function() {\n      return {\n        className: 'ql-editor',\n        theme: 'base',\n        modules: {\n          'link-tooltip': true\n        },\n        content: ''\n      };\n    },\n\n    enterPressed: function() {\n      //console.log(this.editor.getSelection());\n      if(this.props.enterPressed) {\n        this.props.enterPressed();\n      }\n    },\n\n    getInitialState: function() {\n      return {\n        showToolbar: true,\n      };\n    },\n\n    createEditor: function($el, config) {\n      //console.log(this.props);\n      var editor = new Quill($el, config);\n      this.hookEditor(editor);\n      return editor;\n    },\n\n    hookEditor: function(editor) {\n      editor.on('text-change', function(delta, source) {\n        if (this.onEditorChange) {\n          this.onEditorChange(editor.getHTML(), delta, source);\n        }\n      }.bind(this));\n\n      editor.on('selection-change', function(range, source) {\n        if (this.onEditorChangeSelection) {\n          this.onEditorChangeSelection(range, source);\n        }\n      }.bind(this));\n      editor.addModule('enterHandler', {\n        keydown: this.captureReturn\n      });\n      this.setEditorContents(editor, this.props.content);\n    },\n\n    focus: function() {\n      this.state.editor.focus();\n    },\n\n    onEditorChange: function(value, delta, source) {\n      if(value.indexOf(ExtraEnter) > 0) {\n        value = value.replace(ExtraEnter, \"\");\n        this.state.editor.setHTML(value);\n        this.state.editor.setSelection(1, 1);\n      }\n      if(this.props.onContentChanged) {\n        this.props.onContentChanged(value);\n      }\n    },\n\n    captureReturn: function() {\n      if(this.props.captureReturn) {\n        this.props.captureReturn();\n      }\n    },\n\n    getEditorContents: function() {\n      return this.state.content;\n    },\n\n    setEditorContents: function(editor, value) {\n      var sel = editor.getSelection();\n      editor.setHTML(value);\n      if (sel) this.setEditorSelection(editor, sel);\n    },\n\n    isControlled: function() {\n      return 'value' in this.props;\n    },\n\n    getEditorConfig: function() {\n      var config = {\n        theme:        this.props.theme,\n        modules:      this.props.modules,\n        pollInterval: this.props.pollInterval,\n        formats: ['bold', 'italic', 'link']\n      };\n      if (!config.modules.toolbar) {\n        config.modules = JSON.parse(JSON.stringify(config.modules));\n        config.modules.toolbar = {\n          container: this.refs.toolbar.getDOMNode()\n        };\n      }\n      return config;\n    },\n\n    getEditorElement: function() {\n      return this.refs.editor.getDOMNode();\n    },\n\n    componentDidMount: function() {\n      var editor = this.createEditor(\n        this.getEditorElement(),\n        this.getEditorConfig()\n      );\n      this.setState({editor:editor});\n      editor.focus();\n      editor.setHTML(this.props.content);\n    },\n\n    renderItems: function(item, index) {\n      return (\n        <span\n          className={\"ql-format-button ql-\"+item.type}\n          title={item.label}\n          key={index} />\n      );\n    },\n\n    renderGroups: function() {\n      var self = this;\n      var items = this.props.items || defaultItems;\n      //console.log(items);\n      var groups = items.map(function(item, index) {\n        return (\n          <span className={\"ql-format-\"+item.type} key={index}>\n            {item.items.map(self.renderItems)}\n          </span>\n        );\n      });\n      return groups;\n    },\n\n    render: function() {\n      var visibility = (this.state.showToolbar) ? 'visible': 'hidden';\n      var self = this;\n      return (\n        <div className=\"quill-rte\">\n          <div\n            ref=\"toolbar\"\n            className=\"ql-toolbar ql-snow\"\n            style={{visibility: visibility}}>\n            {self.renderGroups()}\n          </div>\n          <div className=\"ql-container ql-snow\" ref=\"editor\" />\n        </div>\n      );\n    }\n\n  });\n\n  APP.QuillComponent = QuillComponent;\n\n  window.Kattappa = APP;\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n  var T = React.PropTypes;\n  var Medium = window.Medium;\n\n  if (React.cloneElement) {\n    var cloneElement = React.cloneElement;\n  } else if (React.addons && React.addons.cloneWithProps) {\n    var cloneElement = React.addons.cloneWithProps;\n  } else {\n    throw new Error('React addons are required when using React 0.12 or less.');\n  }\n\n  var defaultItems = [\n    {\n      label:'Text',\n      type:'group',\n      items: [\n        { type:'bold', label:'Bold'},\n        { type:'italic', label:'Italic'},\n        //{ type:'underline', label:'Underline'},\n        { type:'link', label:'Link'}\n      ]\n    }\n  ];\n\n  /*\n  * Medium Component\n  */\n\n  var MediumComponent = React.createClass({\n\n    onConvert: function(c) {\n      console.log(c);\n      console.log(c.replace(/(<([^>]+)>)/ig,\"\"));\n    },\n\n    getDefaultProps: function() {\n      return {\n        className: 'katap-medium-editor',\n        theme: 'base',\n        modules: {\n          'link-tooltip': true\n        },\n        content: ''\n      };\n    },\n\n    enterPressed: function() {\n      console.log(this.editor.getSelection());\n      if(this.props.enterPressed) {\n        this.props.enterPressed();\n      }\n    },\n\n    getInitialState: function() {\n      return {\n        showToolbar: true,\n      };\n    },\n\n    createEditor: function($el, config) {\n      var editor = new Medium(this.getEditorConfig());\n      //this.hookEditor(editor);\n      return editor;\n    },\n\n    hookEditor: function(editor) {\n      editor.on('text-change', function(delta, source) {\n        if (this.onEditorChange) {\n          this.onEditorChange(editor.getHTML(), delta, source);\n        }\n      }.bind(this));\n\n      editor.on('selection-change', function(range, source) {\n        if (this.onEditorChangeSelection) {\n          this.onEditorChangeSelection(range, source);\n        }\n      }.bind(this));\n      editor.addModule('enterHandler', {\n        keydown: this.captureReturn\n      });\n      this.setEditorContents(editor, this.props.content);\n    },\n\n    focus: function() {\n      this.state.editor.focus();\n    },\n\n    onEditorChange: function(value, delta, source) {\n      if(value.indexOf(ExtraEnter) > 0) {\n        value = value.replace(ExtraEnter, \"\");\n        this.state.editor.setHTML(value);\n        this.state.editor.setSelection(1, 1);\n      }\n      if(this.props.onContentChanged) {\n        this.props.onContentChanged(value);\n      }\n    },\n\n    captureReturn: function() {\n      if(this.props.captureReturn) {\n        this.props.captureReturn();\n      }\n    },\n\n    getEditorContents: function() {\n      return this.state.content;\n    },\n\n    setEditorContents: function(editor, value) {\n      var sel = editor.getSelection();\n      editor.setHTML(value);\n      if (sel) this.setEditorSelection(editor, sel);\n    },\n\n    isControlled: function() {\n      return 'value' in this.props;\n    },\n\n    getEditorConfig: function() {\n      var config = {\n        element: this.getEditorElement(),\n        mode: Medium.inlineRichMode,\n        tags: {\n          'innerLevel': ['a', 'b', 'i'],\n          'break': 'br',\n          'horizontalRule': 'hr',\n          'paragraph': 'p',\n        },\n        cssClasses: {\n          editor: 'Medium',\n          pasteHook: 'Medium-paste-hook',\n          placeholder: 'Medium-placeholder',\n          clear: 'Medium-clear'\n        },\n        attributes: {\n          remove: ['style', 'class']\n        },\n        pasteAsText: false,\n      };\n      return config;\n    },\n\n    getEditorElement: function() {\n      return this.refs.editor.getDOMNode();\n    },\n\n    componentDidMount: function() {\n      var editor = this.createEditor(\n        this.getEditorConfig()\n      );\n      this.setState({editor:editor});\n      editor.focus();\n      console.log(editor);\n      //editor.setHTML(this.props.content);\n    },\n\n    renderItems: function(item, index) {\n      return (\n        <span\n          className={\"ql-format-button ql-\"+item.type}\n          title={item.label}\n          key={index} />\n      );\n    },\n\n    renderGroups: function() {\n      var self = this;\n      var items = this.props.items || defaultItems;\n      //console.log(items);\n      var groups = items.map(function(item, index) {\n        return (\n          <span className={\"ql-format-\"+item.type} key={index}>\n            {item.items.map(self.renderItems)}\n          </span>\n        );\n      });\n      return groups;\n    },\n\n    render: function() {\n      //var visibility = (this.state.showToolbar) ? 'visible': 'hidden';\n      var visibility = 'visible';\n      var self = this;\n      return (\n        <div className=\"katap-medium-rte\">\n          <div\n            ref=\"toolbar\"\n            className=\"katap-medium-toolbar\"\n            style={{visibility: visibility}}>\n            {self.renderGroups()}\n          </div>\n          <div className=\"katap-medium-container\" ref=\"editor\" />\n        </div>\n      );\n    }\n\n  });\n\n  APP.MediumComponent = MediumComponent;\n\n  window.Kattappa = APP;\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var initialState = {\n    blocks: []\n  };\n\n  var Action = APP.Action;\n\n  var Editor = React.createClass({\n    getInitialState: function() {\n      return initialState;\n    },\n\n    getDefaultProps: function() {\n      return {\n        blockUrl: ''\n      };\n    },\n\n    componentDidMount: function() {\n      var self = this;\n      if(this.props.blockUrl !== '') {\n        fetch(self.props.blockUrl, {\n          credentials: 'same-origin',\n          headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n          }\n        }).then(function(response) {\n          if (response.status >= 200 && response.status < 300) {\n            return response.json();\n          } else {\n            var error = new Error(response.statusText);\n            error.response = response;\n            throw error;\n          }\n        }).then(function(json) {\n          if(self.props.processData) {\n            self.setState({\n              blocks: self.props.processData(json)\n            });\n          } else {\n            console.warn('Provide a function to process blocks.');\n          }\n        }).catch(function(e) {\n          console.error(e);\n        })\n      }\n    },\n\n    handleBlockAction: function(action, position) {\n      var newBlocks = this.state.blocks;\n      if(action === Action.REMOVE) {\n        if(APP.Blocks[newBlocks[position].type].isEmpty(newBlocks[position].content) || confirm('Sure?')) {\n          newBlocks.splice(position, 1);\n        } else {\n          return;\n        }\n      } else if(action === Action.UP) {\n        newBlocks.splice(position - 1, 2, newBlocks[position], newBlocks[position-1]);\n      } else if(action === Action.DOWN) {\n        newBlocks.splice(position , 2, newBlocks[position + 1], newBlocks[position]);\n      }\n      this.setState({\n        blocks: newBlocks\n      });\n    },\n\n    addBlock: function(type, position) {\n      if(position < 0 || position > this.state.blocks.length) {\n        return;\n      }\n      var newBlock = {\n        type: type,\n        content: APP.Blocks[type].Empty(),\n        key: APP.uuid()\n      };\n      var newBlocks = this.state.blocks;\n      newBlocks.splice(position+1, 0, newBlock);\n      this.setState({\n        blocks: newBlocks\n      });\n    },\n\n    contentChange: function(position, content) {\n      var newBlocks = this.state.blocks;\n      newBlocks[position].content = content;\n      this.setState({\n        blocks: newBlocks\n      });\n    },\n\n    getToolbar: function(index) {\n      return (\n        <APP.BlockControl\n          blockAction={this.handleBlockAction}\n          position={index}\n          length={this.state.blocks.length} />\n      );\n    },\n\n    renderBlocks: function() {\n      var self = this;\n      var blocks = this.props.blocks || this.state.blocks;\n      if(blocks.length < 1) {\n        return (\n          <APP.Toolbar\n            position={0}\n            addBlock={this.addBlock} />\n        );\n      }\n      var rndr = blocks.map(function(block, index) {\n\n        return (\n          React.createElement(\"div\", {key: block.key, className: \"katap-container\"},\n            self.getToolbar(index),\n            React.createElement(APP.Blocks[block.type].React, {\n              ref: 'block'+index, \n              position: index, \n              content: block.content, \n              addBlock: self.addBlock, \n              onContentChanged: self.contentChange}), \n            React.createElement(APP.Toolbar, {\n              position: index, \n              addBlock: self.addBlock})\n          )\n        );\n      });\n      return rndr;\n    },\n\n    passBlocks: function() {\n      if(this.props.onSave) {\n        this.props.onSave(this.state.blocks);\n      }\n    },\n\n    render: function() {\n      if(this.state.blocks.length > 0) {\n        return (\n          <div className='katap-listing'>\n            <button\n              onClick={this.passBlocks}\n              className=\"katap-savebtn\">Save</button>\n            {this.renderBlocks()}\n          </div>\n        );\n      }\n      return (\n        <div className='katap-listing'>\n          {this.renderBlocks()}\n        </div>\n      );\n    }\n  });\n  \n  APP.Editor = Editor;\n  window.Kattappa = APP;\n\n})(window);\n\n"],"sourceRoot":"/source/"}
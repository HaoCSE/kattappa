/**
 * Kattappa - A block based rich text editor with support of Images, embeds( Youtube, twitter, etc)
 * @version v0.1.2
 * @link https://github.com/brijeshb42/kattappa
 * @license MIT
 */
{"version":3,"sources":["kattappa.js"],"names":["window","Quill","React","Error","initializeTouchEvents","APP","Kattappa","BlockStructure","Text","Image","Quote","UL","content","key","OL","Embed","H2","uuid","s4","Math","floor","random","toString","substring","Keys","ENTER","ESC","BACKSPACE","Action","UP","DOWN","REMOVE","Blocks","QuillEnterHandler","quill","options","this","enterKey","require","KEYS","keyup","editor","root","addEventListener","event","keyCode","preventDefault","stopPropagation","call","keydown","registerModule","BlockText","createClass","displayName","captureReturn","props","addBlock","position","onContentChanged","render","createElement","className","QuillComponent","Name","Icon","Empty","Description","isEmpty","replace","BlockQuote","console","log","HR","Droppable","getInitialState","getDefaultProps","supportClick","multiple","getClassName","state","componentDidMount","refs","droppable","getDOMNode","focus","onDragOver","e","dataTransfer","dropEffect","effectAllowed","setState","onDragLeave","onClick","fileInput","findDOMNode","input","value","click","onDrop","files","target","maxFiles","length","i","preview","URL","createObjectURL","Array","prototype","slice","ref","type","style","display","onChange","children","UploadUrl","BlockImage","message","handleImage","self","file","indexOf","alert","data","FormData","append","fetch","method","credentials","body","then","response","status","json","error","statusText","src","LI","addItem","push","handleItemRemove","action","splice","renderListItem","li","map","item","index","BlockControl","onlyRemove","blockAction","getDomain","url","a","document","href","hostname","urlRegExp","loaded","domain","checkUrls","isProp","test","Types","handleUrl","checkContent","ok","renderBlock","placeholder","onKeyUp","Instagram","id","valid","regex","validate","match","exec","lastIndex","frameBorder","allowFullScreen","instagram","Youtube","width","height","youtu","Vimeo","vimeo","blocks","Toolbar","visible","types","Object","keys","toggleState","nodes","currentTarget","getAttribute","title","typ","pos","handleClick","getToolbar","data-action","buttons","ExtraEnter","PropTypes","cloneElement","addons","cloneWithProps","defaultItems","label","items","onConvert","c","theme","modules","link-tooltip","enterPressed","getSelection","showToolbar","createEditor","$el","config","hookEditor","on","delta","source","onEditorChange","getHTML","bind","range","onEditorChangeSelection","addModule","setEditorContents","setHTML","setSelection","getEditorContents","sel","setEditorSelection","isControlled","getEditorConfig","pollInterval","formats","toolbar","JSON","parse","stringify","container","getEditorElement","renderItems","renderGroups","groups","visibility","initialState","Editor","blockUrl","headers","Accept","Content-Type","processData","warn","handleBlockAction","newBlocks","confirm","newBlock","contentChange","renderBlocks","rndr","block","passBlocks","onSave"],"mappings":"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","file":"kattappa.js","sourcesContent":["(function(window) {\n\n  'use strict';\n\n  var Quill = window.Quill || null;\n  var React = window.React;\n  if(!React) {\n    throw new Error('React is required for this project to function.');\n  }\n  React.initializeTouchEvents(true);\n  if(!Quill) {\n    throw new Error('Quill is required for this project to function.');\n  }\n\n  var APP = window.Kattappa || {};\n\n  APP.BlockStructure = {\n    Text: '',\n    Image: '',\n    Quote: '',\n    UL: [{\n      content: '',\n      key: ''\n    }],\n    OL: [{\n      content: '',\n      key: ''\n    }],\n    Embed: '',\n    H2: ''\n  };\n\n  APP.uuid = function guid() {\n    function s4() {\n      return Math.floor((1 + Math.random()) * 0x10000)\n        .toString(16)\n        .substring(1);\n    }\n    return s4() + '-' + s4();\n    // return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n    //   s4() + '-' + s4() + s4() + s4();\n  };\n\n  APP.Keys = {\n    ENTER: 13,\n    ESC: 27,\n    BACKSPACE: 8\n  };\n\n  APP.Action = {\n    UP: \"up\",\n    DOWN: \"down\",\n    REMOVE: \"remove\"\n  };\n\n  APP.Blocks = {};\n\n  var QuillEnterHandler = function(quill, options) {\n    //console.log('init enter handler');\n    this.quill = quill;\n    this.options = options;\n\n    var enterKey = Quill.require('dom').KEYS.ENTER;\n\n    if(options && options.keyup && typeof options.keyup === 'function') {\n      quill.editor.root.addEventListener('keyup', function(event) {\n        if(event.keyCode === enterKey) {\n          event.preventDefault();\n          event.stopPropagation();\n          options.keyup.call(null, event);\n        }\n      });\n    }\n    if(options && options.keydown && typeof options.keydown === 'function') {\n      quill.editor.root.addEventListener('keydown', function(event) {\n        if(event.keyCode === enterKey) {\n          event.preventDefault();\n          event.stopPropagation();\n          options.keydown.call(null, event);\n        }\n      });\n    }\n  };\n\n  Quill.registerModule('enterHandler', QuillEnterHandler);\n\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var BlockText = React.createClass({\n\n    captureReturn: function() {\n      this.props.addBlock(\"Text\", this.props.position);\n    },\n\n    onContentChanged: function(content) {\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    render: function() {\n      return (\n        <div className=\"katap-text\">\n          <APP.QuillComponent\n            content={this.props.content}\n            captureReturn={this.captureReturn}\n            onContentChanged={this.onContentChanged} />\n        </div>\n      );\n    }\n\n  });\n  \n  APP.Blocks.Text = {\n    Name: 'Text',\n    React: BlockText,\n    Icon: '',\n    Empty: function() {\n      return '';\n    },\n    Description: 'Text',\n    isEmpty: function(content) {\n      return (content.replace(/(<([^>]+)>)/ig,'') === '');\n    }\n  };\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var BlockQuote = React.createClass({\n\n    // focus: function() {\n    //   //this.quill.focus();\n    // },\n\n    // componentDidMount: function(){\n    //   //this.initiateEditor();\n    //   this.focus();\n    // },\n\n    captureReturn: function() {\n      this.props.addBlock(\"Text\", this.props.position);\n    },\n\n    onContentChanged: function(content) {\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    render: function() {\n      return (\n        <blockquote className=\"katap-text\">\n          <APP.QuillComponent\n            content={this.props.content}\n            captureReturn={this.captureReturn}\n            onContentChanged={this.onContentChanged} />\n        </blockquote>\n      );\n    }\n\n  });\n  \n  //APP.BlockTypes.Text = 'Text';\n  APP.Blocks.Quote = {\n    Name: 'Quote',\n    React: BlockQuote,\n    Icon: '',\n    Empty: function() {\n      return '';\n    },\n    Description: 'Block Quote',\n    isEmpty: function(content) {\n      return (content.replace(/(<([^>]+)>)/ig,'') === '');\n    }\n  };\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var items = [\n    {\n      label:'Text',\n      type:'group',\n      items: [\n        { type:'link', label:'Link'}\n      ]\n    }\n  ];\n\n  var H2 = React.createClass({\n\n    captureReturn: function() {\n      console.log('enter');\n      this.props.addBlock(\"Text\", this.props.position);\n    },\n\n    onContentChanged: function(content) {\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    render: function() {\n      return (\n        <h2 className=\"katap-h2\">\n          <APP.QuillComponent\n            content={this.props.content}\n            captureReturn={this.captureReturn}\n            onContentChanged={this.onContentChanged} />\n        </h2>\n      );\n    }\n\n  });\n\n  var H3 = React.createClass({\n\n    captureReturn: function() {\n      console.log('enter');\n      this.props.addBlock(\"Text\", this.props.position);\n    },\n\n    onContentChanged: function(content) {\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    render: function() {\n      return (\n        <h3 className=\"katap-h3\">\n          <APP.QuillComponent\n            content={this.props.content}\n            captureReturn={this.captureReturn}\n            onContentChanged={this.onContentChanged} />\n        </h3>\n      );\n    }\n\n  });\n\n  var H4 = React.createClass({\n\n    captureReturn: function() {\n      console.log('enter');\n      this.props.addBlock(\"Text\", this.props.position);\n    },\n\n    onContentChanged: function(content) {\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    render: function() {\n      return (\n        <h4 className=\"katap-h4\">\n          <APP.QuillComponent\n            content={this.props.content}\n            captureReturn={this.captureReturn}\n            onContentChanged={this.onContentChanged} />\n        </h4>\n      );\n    }\n\n  });\n  \n  //APP.BlockTypes.Text = 'Text';\n  APP.Blocks.H2 = {\n    Name: 'H2',\n    React: H2,\n    Icon: '',\n    Empty: function() {\n      return '';\n    },\n    Description: 'Heading 2',\n    isEmpty: function(content) {\n      if(content.replace(/(<([^>]+)>)/ig,'') === '') {\n        return true;\n      }\n      return false;\n    }\n  };\n\n  // APP.Blocks.H3 = {\n  //   Name: 'H3',\n  //   React: H3,\n  //   Icon: '',\n  //   Empty: '',\n  //   isEmpty: function(content) {\n  //     if(content.replace(/(<([^>]+)>)/ig,'') === '') {\n  //       return true;\n  //     }\n  //     return false;\n  //   }\n  // };\n\n  // APP.Blocks.H4 = {\n  //   Name: 'H4',\n  //   React: H4,\n  //   Icon: '',\n  //   Empty: '',\n  //   isEmpty: function(content) {\n  //     if(content.replace(/(<([^>]+)>)/ig,'') === '') {\n  //       return true;\n  //     }\n  //     return false;\n  //   }\n  // };\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var HR = React.createClass({\n\n    render: function() {\n      return (\n        <hr className=\"katap-hr\" />\n      );\n    }\n  });\n\n  APP.Blocks.HR = {\n    Name: 'HR',\n    React: HR,\n    Icon: '',\n    Empty: function() {\n      return '';\n    },\n    Description: 'Break',\n    isEmpty: function(content) {\n      return true;\n    }\n  };\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var Droppable = React.createClass({\n    getInitialState: function() {\n      return {\n        className: ''\n      };\n    },\n\n    getDefaultProps: function() {\n      return {\n        supportClick: true,\n        multiple: false\n      };\n    },\n\n    getClassName: function() {\n      return 'katap-droppable '+(this.props.className || this.state.className);\n    },\n\n    componentDidMount: function() {\n      this.refs.droppable.getDOMNode().focus();\n    },\n\n    onDragOver: function(e) {\n      e.preventDefault();\n      e.stopPropagation();\n      e.dataTransfer.dropEffect = 'copy';\n      var effectAllowed = e.dataTransfer.effectAllowed;\n      if (effectAllowed === 'all' || effectAllowed === 'uninitialized') {\n        this.setState({\n          className: 'katap-drop-active'\n        });\n      }\n      if (this.props.onDragOver) {\n        this.props.onDragOver(e);\n      }\n    },\n\n    onDragLeave: function(e) {\n      this.setState({\n        className: ''\n      });\n\n      if (this.props.onDragLeave) {\n        this.props.onDragLeave(e);\n      }\n    },\n\n    onClick: function() {\n      var fileInput = React.findDOMNode(this.refs.input);\n      fileInput.value = null;\n      fileInput.click();\n    },\n\n    onDrop: function(e) {\n      e.preventDefault();\n      var files;\n      if(e.dataTransfer) {\n        files = e.dataTransfer.files;\n      } else if(e.target) {\n        files = e.target.files;\n      }\n      var maxFiles = (this.props.multiple) ? files.length : 1;\n      for (var i = 0; i < maxFiles; i++) {\n        files[i].preview = URL.createObjectURL(files[i]);\n      }\n      if(this.props.onDrop) {\n        files = Array.prototype.slice.call(files, 0, maxFiles);\n        //console.log(files);\n        this.props.onDrop(files);\n      }\n    },\n\n    render: function() {\n      return (\n        <div\n          ref=\"droppable\"\n          className={this.getClassName()}\n          onDragOver={this.onDragOver}\n          onDragLeave={this.onDragLeave}\n          onClick={this.onClick}\n          onDrop={this.onDrop} >\n          <input\n            ref=\"input\"\n            type=\"file\"\n            style={{display: 'none'}}\n            multiple={this.props.multiple}\n            onChange={this.onDrop} />\n          {this.props.children}\n        </div>\n      );\n    }\n  });\n\n  APP.Droppable = Droppable;\n  window.Kattappa = APP;\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var UploadUrl = \"\";\n\n  var BlockImage = React.createClass({\n\n    getInitialState: function() {\n      return {\n        message: 'Drop image here or click to add.'\n      };\n    },\n\n    handleImage: function(files) {\n      var self = this;\n      var file = files[0];\n      if(file.type.indexOf(\"image/\") !== 0) {\n        alert(\"Provide a valid image file.\");\n        return;\n      }\n      if(APP.Blocks.Image.UploadUrl !== \"\") {\n        var data = new FormData();\n        data.append(\"image\", file);\n        fetch(APP.Blocks.Image.UploadUrl, {\n          method: 'POST',\n          credentials: 'same-origin',\n          body: data\n        }).then(function(response) {\n          if(response.status >= 200 && response.status < 300) {\n            return response.json();\n          } else {\n            var error = new Error(response.statusText);\n            error.response = response;\n            throw error;\n          }\n        }).then(function(json) {\n          if(json.type && json.type === \"success\") {\n            //console.log(json);\n            if(self.props.onContentChanged) {\n              self.props.onContentChanged(self.props.position, json.message);\n            }\n          } else {\n            alert('Could not upload.');\n          }\n        }).catch(function(error) {\n          console.log(error);\n          alert('Error while uploading. Retry.');\n        });\n      } else if(this.props.onContentChanged){\n        this.props.onContentChanged(this.props.position, file.preview);\n      }\n    },\n\n    render: function() {\n      if(this.props.content === \"\") {\n        return (\n          <div className=\"katap-image\">\n            <APP.Droppable\n              onDrop={this.handleImage}>\n              <p>{this.state.message}</p>\n            </APP.Droppable>\n          </div>\n        );\n      } else {\n        return (\n          <div className=\"katap-image\">\n            <img src={this.props.content} />\n          </div>\n        );\n      }\n    }\n\n  });\n  \n  //APP.BlockTypes.Text = 'Text';\n  APP.Blocks.Image = {\n    Name: 'Image',\n    React: BlockImage,\n    Icon: '',\n    Empty: function() {\n      return '';\n    },\n    Description: 'Image',\n    UploadUrl: UploadUrl,\n    isEmpty: function(content) {\n      return (content === '');\n    }\n  };\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var Action = APP.Action;\n\n  var LI = React.createClass({\n\n    captureReturn: function() {\n      this.props.addItem(this.props.position);\n    },\n\n    onContentChanged: function(content) {\n      //console.log(content);\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    render: function() {\n      return (\n        <APP.QuillComponent\n          content={this.props.content}\n          captureReturn={this.captureReturn}\n          onContentChanged={this.onContentChanged} />\n      );\n    }\n\n  });\n\n  var UL = React.createClass({\n    onContentChanged: function(position, content) {\n      this.props.content[position].content = content;\n      this.props.onContentChanged(this.props.position, this.props.content);\n    },\n\n    addItem: function(position) {\n      if(position < 0 || position >= this.props.content.length) {\n        return;\n      }\n      var content = this.props.content;\n      content.push({\n        content: '',\n        key: APP.uuid()\n      });\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    handleItemRemove: function(action, position) {\n      console.log(position);\n      if(this.props.content.length < 2) {\n        return;\n      }\n      var content = this.props.content;\n      console.log(content);\n      content.splice(position, 1);\n      console.log(content);\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    renderListItem: function() {\n      var self = this;\n      var li = [];\n      this.props.content.map(function(item, index) {\n        li.push(\n          <li key={item.key}>\n            <APP.BlockControl\n              onlyRemove={true}\n              blockAction={self.handleItemRemove}\n              position={index}\n              length={self.props.content.length} />\n            <LI\n              position={index}\n              content={item.content}\n              addItem={self.addItem}\n              onContentChanged={self.onContentChanged} />\n          </li>\n        );\n      });\n      return li;\n    },\n\n    render: function() {\n      return (\n        <ul className=\"katap-list\">\n        {this.renderListItem()}\n        </ul>\n      );\n    }\n  });\n\n  APP.Blocks.UL = {\n    Name: 'UL',\n    React: UL,\n    Icon: '',\n    Empty: function() {\n      return [{\n        content: '',\n        key: APP.uuid()\n      }];\n    },\n    Description: 'Undordered List',\n    isEmpty: function(content) {\n      for(var i = 0; i<content.length; i++) {\n        if(content[i].content.replace(/(<([^>]+)>)/ig,'') !== '') {\n          return false\n        }\n      }\n      return true;\n    }\n  };\n\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var Action = APP.Action;\n\n  var LI = React.createClass({\n\n    captureReturn: function() {\n      this.props.addItem(this.props.position);\n    },\n\n    onContentChanged: function(content) {\n      //console.log(content);\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    render: function() {\n      return (\n        <APP.QuillComponent\n          content={this.props.content}\n          captureReturn={this.captureReturn}\n          onContentChanged={this.onContentChanged} />\n      );\n    }\n\n  });\n\n  var OL = React.createClass({\n    onContentChanged: function(position, content) {\n      this.props.content[position].content = content;\n      this.props.onContentChanged(this.props.position, this.props.content);\n    },\n\n    addItem: function(position) {\n      if(position < 0 || position >= this.props.content.length) {\n        return;\n      }\n      var content = this.props.content;\n      content.push({\n        content: '',\n        key: APP.uuid()\n      });\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    handleItemRemove: function(action, position) {\n      console.log(position);\n      if(this.props.content.length < 2) {\n        return;\n      }\n      var content = this.props.content;\n      console.log(content);\n      content.splice(position, 1);\n      console.log(content);\n      this.props.onContentChanged(this.props.position, content);\n    },\n\n    renderListItem: function() {\n      var self = this;\n      var li = [];\n      this.props.content.map(function(item, index) {\n        li.push(\n          <li key={item.key}>\n            <APP.BlockControl\n              onlyRemove={true}\n              blockAction={self.handleItemRemove}\n              position={index}\n              length={self.props.content.length} />\n            <LI\n              position={index}\n              content={item.content}\n              addItem={self.addItem}\n              onContentChanged={self.onContentChanged} />\n          </li>\n        );\n      });\n      return li;\n    },\n\n    render: function() {\n      return (\n        <ol className=\"katap-list\">\n        {this.renderListItem()}\n        </ol>\n      );\n    }\n  });\n\n  APP.Blocks.OL = {\n    Name: 'OL',\n    React: OL,\n    Icon: '',\n    Empty: function() {\n      return [{\n        content: '',\n        key: APP.uuid()\n      }];\n    },\n    Description: 'Ordered List',\n    isEmpty: function(content) {\n      for(var i = 0; i<content.length; i++) {\n        if(content[i].content.replace(/(<([^>]+)>)/ig,'') !== '') {\n          return false\n        }\n      }\n      return true;\n    }\n  };\n\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var urlRegExp =/^(?:(?:https?|ftp):\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!10(?:\\.\\d{1,3}){3})(?!127(?:\\.\\d{1,3}){3})(?!169\\.254(?:\\.\\d{1,3}){2})(?!192\\.168(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:\\/[^\\s]*)?$/i;\n  \n  function getDomain(url) {\n    var a = window.document.createElement(\"a\");\n    a.href = url;\n    return a.hostname;\n  }\n\n  var Embed = React.createClass({\n\n    getInitialState: function() {\n      return {\n        loaded: false,\n        domain: '',\n        url: ''\n      };\n    },\n\n    getDefaultProps: function() {\n      return {\n        content: ''\n      };\n    },\n\n    checkUrls: function(url, isProp){\n      if(urlRegExp.test(url)) {\n        var domain = getDomain(url);\n        for(var key in APP.Blocks.Embed.Types) {\n          if(domain.indexOf(key) > -1) {\n            this.setState({\n              loaded: true,\n              domain: key,\n              url: url\n            });\n            return;\n          }\n        }\n        alert('This URL is not supported.');\n        this.refs.getDOMNode().value = '';\n      } else {\n        if(!isProp) {\n          alert(\"Enter a valid url\");\n        }\n      }\n    },\n\n    handleUrl: function(event) {\n      if(event.keyCode === APP.Keys.ENTER) {\n        this.checkUrls(event.target.value, false);\n      }\n    },\n\n    componentDidMount: function() {\n      this.refs.input.getDOMNode().focus();\n      this.checkUrls(this.props.content, true);\n    },\n\n    checkContent: function(ok) {\n      if(ok) {\n        this.props.onContentChanged(this.props.position, this.state.url);\n      } else if(this.props.content === this.state.url) {\n      } else {\n        this.setState({\n          loaded: false\n        });\n      }\n    },\n\n    renderBlock: function() {\n      return (\n        React.createElement(APP.Blocks.Embed.Types[this.state.domain], {\n          url: this.state.url,\n          checkContent: this.checkContent\n        })\n      );\n    },\n\n    render: function() {\n      if(this.state.loaded) {\n        return this.renderBlock();\n      } else {\n        return (\n          <div className=\"katap-embed\">\n            <input\n              ref=\"input\"\n              type=\"text\"\n              placeholder=\"Enter URL and press enter\"\n              onKeyUp={this.handleUrl} />\n          </div>\n        );\n      }\n    }\n  });\n\n  APP.Blocks.Embed = {\n    Name: 'Embed',\n    React: Embed,\n    Icon: '',\n    Empty: function() {\n      return '';\n    },\n    Description: 'Embed',\n    isEmpty: function(content) {\n      return (content === '');\n    },\n    Types: {}\n  };\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n\n  var APP = window.Kattappa || {};\n  var Types = APP.Blocks.Embed.Types || {};\n\n  var Instagram = React.createClass({\n\n    getInitialState: function() {\n      return {\n        message: 'Wait',\n        id: '',\n        valid: false\n      };\n    },\n\n    getDefaultProps: function() {\n      return {\n        url: '',\n        regex: /https?:\\/\\/instagram\\.com\\/p\\/([^\\/]+)\\/?.*/gi\n      };\n    },\n\n    componentDidMount: function() {\n      this.validate();\n    },\n\n    validate: function() {\n      var match;\n      match = this.props.regex.exec(this.props.url);\n      this.props.regex.lastIndex = 0;\n      if(!match) {\n        this.props.checkContent(false);\n        this.setState({\n          message: 'error.'\n        });\n        return;\n      }\n      this.setState({\n        message: 'OK.',\n        id: match[1],\n        valid: true\n      });\n      this.props.checkContent(true);\n    },\n\n    render: function() {\n      if(this.state.valid) {\n        return (\n          <div className=\"katap-embed katap-instagram\">\n          <iframe\n          src={'//instagram.com/p/'+this.state.id+'/embed'}\n          frameBorder={0}\n          allowFullScreen={true} />\n          </div>\n          );\n      }\n      return (\n        <div className=\"katap-embed\">Invalid instagram URL.</div>\n        );\n    }\n  });\n  \n  Types.instagram = Instagram;\n  \n  APP.Blocks.Embed.Types = Types\n  window.Kattappa = APP;\n})(window);\n\n(function(window) {\n\n  var APP = window.Kattappa || {};\n  var Types = APP.Blocks.Embed.Types || {};\n\n  var Youtube = React.createClass({\n\n    getInitialState: function() {\n      return {\n        message: 'Wait',\n        id: '',\n        valid: false\n      };\n    },\n\n    getDefaultProps: function() {\n      return {\n        url: '',\n        regex: /^.*(?:(?:youtu\\.be\\/)|(?:youtube\\.com)\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=|\\&v=)([^#\\&\\?]*)/\n      };\n    },\n\n    componentDidMount: function() {\n      this.validate();\n    },\n\n    validate: function() {\n      var match;\n      match = this.props.regex.exec(this.props.url);\n      this.props.regex.lastIndex = 0;\n      if(!match) {\n        this.props.checkContent(false);\n        this.setState({\n          message: 'error.'\n        });\n        return;\n      }\n      this.setState({\n        message: 'OK.',\n        id: match[1],\n        valid: true\n      });\n      this.props.checkContent(true);\n    },\n\n    render: function() {\n      if(this.state.valid) {\n        return (\n          <div className=\"katap-embed katap-youtube\">\n          <iframe\n            src={'//youtube.com/embed/'+this.state.id}\n            frameBorder={0}\n            width={580}\n            height={320}\n            allowFullScreen={true} />\n          </div>\n        );\n      }\n      return (\n        <div className=\"katap-embed\">Invalid youtube URL.</div>\n      );\n    }\n  });\n  \n  Types.youtu = Youtube;\n  \n  APP.Blocks.Embed.Types = Types\n  window.Kattappa = APP;\n})(window);\n\n(function(window) {\n\n  var APP = window.Kattappa || {};\n  var Types = APP.Blocks.Embed.Types || {};\n\n  var Vimeo = React.createClass({\n\n    getInitialState: function() {\n      return {\n        message: 'Wait',\n        id: '',\n        valid: false\n      };\n    },\n\n    getDefaultProps: function() {\n      return {\n        url: '',\n        regex: /(?:http[s]?:\\/\\/)?(?:www.)?vimeo\\.co(?:.+(?:\\/)([^\\/].*)+$)/\n      };\n    },\n\n    componentDidMount: function() {\n      this.validate();\n    },\n\n    validate: function() {\n      var match;\n      match = this.props.regex.exec(this.props.url);\n      this.props.regex.lastIndex = 0;\n      if(!match) {\n        this.props.checkContent(false);\n        this.setState({\n          message: 'error.'\n        });\n        return;\n      }\n      this.setState({\n        message: 'OK.',\n        id: match[1],\n        valid: true\n      });\n      this.props.checkContent(true);\n    },\n\n    render: function() {\n      if(this.state.valid) {\n        return (\n          <div className=\"katap-embed katap-vimeo\">\n          <iframe\n            src={'//player.vimeo.com/video/'+this.state.id}\n            frameBorder={0}\n            width={580}\n            height={320}\n            allowFullScreen={true} />\n          </div>\n        );\n      }\n      return (\n        <div className=\"katap-embed\">Invalid vimeo URL.</div>\n      );\n    }\n  });\n  \n  Types.vimeo = Vimeo;\n  \n  APP.Blocks.Embed.Types = Types\n  window.Kattappa = APP;\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var Action = APP.Action;\n  var blocks = APP.Blocks;\n\n  var Toolbar = React.createClass({\n    getInitialState: function() {\n      return {\n        visible: false,\n        types: Object.keys(blocks)\n      };\n    },\n\n    toggleState: function(e) {\n      var nodes = Array.prototype.slice.call(e.currentTarget.children);\n      var index = nodes.indexOf( e.target );\n      if(index < 0) {\n        return;\n      }\n      this.setState({\n        visible: !this.state.visible\n      });\n      if(!this.state.visible || index === 0) {\n      } else {\n        this.props.addBlock(nodes[index].getAttribute('title'), this.props.position);\n      }\n    },\n\n    addBlock: function(type, position) {\n      this.props.addBlock()\n    },\n\n    render: function() {\n      var self = this;\n      if(!this.state.visible) {\n        return (\n          <div\n            className=\"katap-toolbar\"\n            onClick={this.toggleState}>\n            <button title=\"Add block\">+</button>\n          </div>\n        );\n      }\n      return (\n        <div\n          className=\"katap-toolbar\"\n          onClick={this.toggleState}>\n          <button title=\"Close\">&times;</button>\n          {this.state.types.map(function(typ, pos) {\n              return (\n                <button\n                  title={typ}\n                  key={pos}>\n                  {blocks[typ].Description}\n                </button>\n              );\n            })}\n        </div>\n      );\n    }\n  });\n\n  /*\n  ** Handles block positioning. Can remove a block or move it up/down as required.\n  */\n  var BlockControl = React.createClass({\n\n    getDefaultProps: function() {\n      onlyRemove: false\n    },\n\n    handleClick: function(e) {\n      //console.log(e);\n      var nodes = Array.prototype.slice.call(e.currentTarget.children);\n      var index = nodes.indexOf(e.target);\n      if(index < 0) {\n        return;\n      }\n      var action = nodes[index].getAttribute(\"data-action\");\n      this.props.blockAction(action, this.props.position);\n    },\n\n    getToolbar: function(index) {\n      // if(index === 0 && this.props.length < 2) {\n      //   return null;\n      // } \n      if(this.props.onlyRemove) {\n        return (\n          <div\n            className=\"katap-control-toolbar\"\n            onClick={this.handleClick}>\n            <button title=\"Remove\" data-action={Action.REMOVE} key={Action.REMOVE}>&times;</button>\n          </div>\n        );\n      }\n      var buttons = [];\n      if(index === 0 && this.props.length < 2) {\n        buttons.push(<button title=\"Remove\" data-action={Action.REMOVE} key={Action.REMOVE}>&times;</button>);\n      } else if(index === 0) {\n        buttons.push(<button title=\"Remove\" data-action={Action.REMOVE} key={Action.REMOVE}>&times;</button>);\n        buttons.push(<button title=\"Move Down\" data-action={Action.DOWN} key={Action.DOWN}>↓</button>);\n      } else if(index === this.props.length-1) {\n        buttons.push(<button title=\"Remove\" data-action={Action.REMOVE} key={Action.REMOVE}>&times;</button>);\n        buttons.push(<button title=\"Move Up\" data-action={Action.UP} key={Action.UP}>↑</button>);\n      } else {\n        buttons.push(<button title=\"Remove\" data-action={Action.REMOVE} key={Action.REMOVE}>&times;</button>);\n        buttons.push(<button title=\"Move Up\" data-action={Action.UP} key={Action.UP}>↑</button>);\n        buttons.push(<button title=\"Move Down\" data-action={Action.DOWN} key={Action.DOWN}>↓</button>);\n      }\n      return (\n        <div\n          className=\"katap-control-toolbar\"\n          onClick={this.handleClick}>\n          {buttons}\n        </div>\n      );\n    },\n\n    render: function() {\n      return this.getToolbar(this.props.position);\n    }\n  });\n\n  APP.Toolbar = Toolbar;\n  APP.BlockControl = BlockControl;\n  window.Kattappa = APP;\n\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n  var T = React.PropTypes;\n\n  var ExtraEnter = \"<div><br></div>\";\n\n  if (React.cloneElement) {\n    var cloneElement = React.cloneElement;\n  } else if (React.addons && React.addons.cloneWithProps) {\n    var cloneElement = React.addons.cloneWithProps;\n  } else {\n    throw new Error('React addons are required when using React 0.12 or less.');\n  }\n\n  var defaultItems = [\n    {\n      label:'Text',\n      type:'group',\n      items: [\n        { type:'bold', label:'Bold'},\n        { type:'italic', label:'Italic'},\n        //{ type:'underline', label:'Underline'},\n        { type:'link', label:'Link'}\n      ]\n    }\n  ];\n\n  /*\n  * Quill Component\n  */\n\n  var QuillComponent = React.createClass({\n\n    onConvert: function(c) {\n      console.log(c);\n      console.log(c.replace(/(<([^>]+)>)/ig,\"\"));\n    },\n\n    getDefaultProps: function() {\n      return {\n        className: 'ql-editor',\n        theme: 'base',\n        modules: {\n          'link-tooltip': true\n        },\n        content: ''\n      };\n    },\n\n    enterPressed: function() {\n      console.log(this.editor.getSelection());\n      if(this.props.enterPressed) {\n        this.props.enterPressed();\n      }\n    },\n\n    getInitialState: function() {\n      return {\n        showToolbar: true,\n      };\n    },\n\n    createEditor: function($el, config) {\n      //console.log(this.props);\n      var editor = new Quill($el, config);\n      this.hookEditor(editor);\n      return editor;\n    },\n\n    hookEditor: function(editor) {\n      editor.on('text-change', function(delta, source) {\n        if (this.onEditorChange) {\n          this.onEditorChange(editor.getHTML(), delta, source);\n        }\n      }.bind(this));\n\n      editor.on('selection-change', function(range, source) {\n        if (this.onEditorChangeSelection) {\n          this.onEditorChangeSelection(range, source);\n        }\n      }.bind(this));\n      editor.addModule('enterHandler', {\n        keydown: this.captureReturn\n      });\n      this.setEditorContents(editor, this.props.content);\n    },\n\n    focus: function() {\n      this.state.editor.focus();\n    },\n\n    onEditorChange: function(value, delta, source) {\n      //console.log(value+\" - val\");\n      //console.log(value);\n      if(value.indexOf(ExtraEnter) > 0) {\n        value = value.replace(ExtraEnter, \"\");\n        //this.state.editor.setHTML(value.replace(/(<([^>]+)>)/ig,\"\"));\n        //this.state.editor.setHTML(value.replace(/(<(?!\\/?(em|b|i|u|strong)[ >])[^>]*>)/ig,\"\"));\n        //console.log(value);\n        this.state.editor.setHTML(value);\n        this.state.editor.setSelection(1, 1);\n      }\n      if(this.props.onContentChanged) {\n        this.props.onContentChanged(value);\n      }\n    },\n\n    captureReturn: function() {\n      // var sel = this.state.editor.getSelection();\n      // var len = this.state.editor.getLength();\n      // console.log(sel);\n      // console.log(len);\n      // if(sel.start === sel.end && sel.start < len) {\n      //   return;\n      // }\n      // console.log();\n      if(this.props.captureReturn) {\n        this.props.captureReturn();\n      }\n    },\n\n    getEditorContents: function() {\n      return this.state.content;\n    },\n\n    setEditorContents: function(editor, value) {\n      var sel = editor.getSelection();\n      editor.setHTML(value);\n      if (sel) this.setEditorSelection(editor, sel);\n    },\n\n    isControlled: function() {\n      return 'value' in this.props;\n    },\n\n    getEditorConfig: function() {\n      var config = {\n        theme:        this.props.theme,\n        modules:      this.props.modules,\n        pollInterval: this.props.pollInterval,\n        formats: ['bold', 'italic', 'link']\n      };\n      if (!config.modules.toolbar) {\n        config.modules = JSON.parse(JSON.stringify(config.modules));\n        config.modules.toolbar = {\n          container: this.refs.toolbar.getDOMNode()\n        };\n      }\n      return config;\n    },\n\n    getEditorElement: function() {\n      return this.refs.editor.getDOMNode();\n    },\n\n    componentDidMount: function() {\n      //console.log(this.props);\n      var editor = this.createEditor(\n        this.getEditorElement(),\n        this.getEditorConfig()\n      );\n      this.setState({editor:editor});\n      editor.focus();\n      editor.setHTML(this.props.content);\n      //window.edi = editor;\n    },\n\n    renderItems: function(item, index) {\n      return (\n        <span\n          className={\"ql-format-button ql-\"+item.type}\n          title={item.label}\n          key={index} />\n      );\n    },\n\n    renderGroups: function() {\n      var self = this;\n      var items = this.props.items || defaultItems;\n      //console.log(items);\n      var groups = items.map(function(item, index) {\n        return (\n          <span className={\"ql-format-\"+item.type} key={index}>\n            {item.items.map(self.renderItems)}\n          </span>\n        );\n      });\n      return groups;\n    },\n\n    render: function() {\n      var visibility = (this.state.showToolbar) ? 'visible': 'hidden';\n      var self = this;\n      return (\n        <div className=\"quill-rte\">\n          <div\n            ref=\"toolbar\"\n            className=\"ql-toolbar ql-snow\"\n            style={{visibility: visibility}}>\n            {self.renderGroups()}\n          </div>\n          <div className=\"ql-container ql-snow\" ref=\"editor\" />\n        </div>\n      );\n    }\n\n  });\n\n  APP.QuillComponent = QuillComponent;\n\n  window.Kattappa = APP;\n})(window);\n\n(function(window) {\n  var APP = window.Kattappa || {};\n\n  var initialState = {\n    blocks: []\n  };\n\n  var Action = APP.Action;\n\n  var Editor = React.createClass({\n    getInitialState: function() {\n      return initialState;\n    },\n\n    getDefaultProps: function() {\n      return {\n        blockUrl: ''\n      };\n    },\n\n    componentDidMount: function() {\n      var self = this;\n      if(this.props.blockUrl !== '') {\n        fetch(self.props.blockUrl, {\n          credentials: 'same-origin',\n          headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n          }\n        }).then(function(response) {\n          if (response.status >= 200 && response.status < 300) {\n            return response.json();\n          } else {\n            var error = new Error(response.statusText);\n            error.response = response;\n            throw error;\n          }\n        }).then(function(json) {\n          if(self.props.processData) {\n            self.setState({\n              blocks: self.props.processData(json)\n            });\n          } else {\n            console.warn('Provide a function to process blocks.');\n          }\n        }).catch(function(e) {\n          console.error(e);\n        })\n      }\n    },\n\n    handleBlockAction: function(action, position) {\n      var newBlocks = this.state.blocks;\n      if(action === Action.REMOVE) {\n        if(APP.Blocks[newBlocks[position].type].isEmpty(newBlocks[position].content) || confirm('Sure?')) {\n          newBlocks.splice(position, 1);\n        } else {\n          return;\n        }\n      } else if(action === Action.UP) {\n        newBlocks.splice(position - 1, 2, newBlocks[position], newBlocks[position-1]);\n      } else if(action === Action.DOWN) {\n        newBlocks.splice(position , 2, newBlocks[position + 1], newBlocks[position]);\n      }\n      this.setState({\n        blocks: newBlocks\n      });\n    },\n\n    addBlock: function(type, position) {\n      if(position < 0 || position > this.state.blocks.length) {\n        return;\n      }\n      var newBlock = {\n        type: type,\n        content: APP.Blocks[type].Empty(),\n        key: APP.uuid()\n      };\n      var newBlocks = this.state.blocks;\n      newBlocks.splice(position+1, 0, newBlock);\n      this.setState({\n        blocks: newBlocks\n      });\n    },\n\n    contentChange: function(position, content) {\n      var newBlocks = this.state.blocks;\n      newBlocks[position].content = content;\n      this.setState({\n        blocks: newBlocks\n      });\n    },\n\n    getToolbar: function(index) {\n      return (\n        <APP.BlockControl\n          blockAction={this.handleBlockAction}\n          position={index}\n          length={this.state.blocks.length} />\n      );\n    },\n\n    renderBlocks: function() {\n      var self = this;\n      var blocks = this.props.blocks || this.state.blocks;\n      if(blocks.length < 1) {\n        return (\n          <APP.Toolbar\n            position={0}\n            addBlock={this.addBlock} />\n        );\n      }\n      var rndr = blocks.map(function(block, index) {\n\n        return (\n          React.createElement(\"div\", {key: block.key, className: \"katap-container\"},\n            self.getToolbar(index),\n            React.createElement(APP.Blocks[block.type].React, {\n              ref: 'block'+index, \n              position: index, \n              content: block.content, \n              addBlock: self.addBlock, \n              onContentChanged: self.contentChange}), \n            React.createElement(APP.Toolbar, {\n              position: index, \n              addBlock: self.addBlock})\n          )\n        );\n      });\n      return rndr;\n    },\n\n    passBlocks: function() {\n      if(this.props.onSave) {\n        this.props.onSave(this.state.blocks);\n      }\n    },\n\n    render: function() {\n      if(this.state.blocks.length > 0) {\n        return (\n          <div className='katap-listing'>\n            <button\n              onClick={this.passBlocks}\n              className=\"katap-savebtn\">Save</button>\n            {this.renderBlocks()}\n          </div>\n        );\n      }\n      return (\n        <div className='katap-listing'>\n          {this.renderBlocks()}\n        </div>\n      );\n    }\n  });\n  \n  APP.Editor = Editor;\n  window.Kattappa = APP;\n\n})(window);\n\n"],"sourceRoot":"/source/"}
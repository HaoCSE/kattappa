/**
 * Kattappa - A block based rich text editor with support of Images, embeds( Youtube, twitter, etc)
 * @version v0.2.0
 * @link https://github.com/brijeshb42/kattappa
 * @license MIT
 */
"use strict";!function(window){var Quill=window.Quill||null,React=window.React;if(!React)throw new Error("React is required for this project to function.");React.initializeTouchEvents(!0);var APP=window.Kattappa||{};APP.BlockStructure={Text:"",Image:"",Quote:"",UL:[{content:"",key:""}],OL:[{content:"",key:""}],Embed:"",H2:""},APP.uuid=function(){function s4(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return s4()+"-"+s4()},APP.Keys={ENTER:13,ESC:27,BACKSPACE:8},APP.Action={UP:"up",DOWN:"down",REMOVE:"remove"},APP.Blocks={};var QuillEnterHandler=function(quill,options){this.quill=quill,this.options=options;var enterKey=Quill.require("dom").KEYS.ENTER;options&&options.keyup&&"function"==typeof options.keyup&&quill.editor.root.addEventListener("keyup",function(event){event.keyCode===enterKey&&(event.preventDefault(),event.stopPropagation(),options.keyup.call(null,event))}),options&&options.keydown&&"function"==typeof options.keydown&&quill.editor.root.addEventListener("keydown",function(event){event.keyCode===enterKey&&(event.preventDefault(),event.stopPropagation(),options.keydown.call(null,event))})};Quill.registerModule("enterHandler",QuillEnterHandler),window.Kattappa=APP}(window),function(window){var APP=window.Kattappa||{},BlockText=React.createClass({displayName:"BlockText",captureReturn:function(){this.props.addBlock("Text",this.props.position)},onContentChanged:function(content){this.props.onContentChanged(this.props.position,content)},render:function(){return React.createElement("div",{className:"katap-text"},React.createElement(APP.QuillComponent,{content:this.props.content,captureReturn:this.captureReturn,onContentChanged:this.onContentChanged}))}});APP.Blocks.Text={Name:"Text",React:BlockText,Icon:"",Empty:function(){return""},Description:"Text",isEmpty:function(content){return""===content.replace(/(<([^>]+)>)/gi,"")}},window.Kattappa=APP}(window),function(window){var APP=window.Kattappa||{},BlockQuote=React.createClass({displayName:"BlockQuote",captureReturn:function(){this.props.addBlock("Text",this.props.position)},onContentChanged:function(content){var content={content:content,credit:this.props.content.credit};this.props.onContentChanged(this.props.position,content)},onCreditChange:function(e){var content={content:this.props.content.content,credit:e.target.value};this.props.onContentChanged(this.props.position,content)},render:function(){return React.createElement("blockquote",{className:"katap-text"},React.createElement("input",{className:"katap-blockquote-credit",type:"text",placeholder:"Credit",onChange:this.onCreditChange,value:this.props.content.credit}),React.createElement(APP.QuillComponent,{content:this.props.content.content,captureReturn:this.captureReturn,onContentChanged:this.onContentChanged}))}});APP.Blocks.Quote={Name:"Quote",React:BlockQuote,Icon:"",Empty:function(){return{content:"",credit:""}},Description:"Block Quote",isEmpty:function(content){return""===content.replace(/(<([^>]+)>)/gi,"")}},window.Kattappa=APP}(window),function(window){{var APP=window.Kattappa||{},H2=React.createClass({displayName:"H2",captureReturn:function(){console.log("enter"),this.props.addBlock("Text",this.props.position)},onContentChanged:function(content){this.props.onContentChanged(this.props.position,content)},render:function(){return React.createElement("h2",{className:"katap-h2"},React.createElement(APP.QuillComponent,{content:this.props.content,captureReturn:this.captureReturn,onContentChanged:this.onContentChanged}))}});React.createClass({displayName:"H3",captureReturn:function(){console.log("enter"),this.props.addBlock("Text",this.props.position)},onContentChanged:function(content){this.props.onContentChanged(this.props.position,content)},render:function(){return React.createElement("h3",{className:"katap-h3"},React.createElement(APP.QuillComponent,{content:this.props.content,captureReturn:this.captureReturn,onContentChanged:this.onContentChanged}))}}),React.createClass({displayName:"H4",captureReturn:function(){console.log("enter"),this.props.addBlock("Text",this.props.position)},onContentChanged:function(content){this.props.onContentChanged(this.props.position,content)},render:function(){return React.createElement("h4",{className:"katap-h4"},React.createElement(APP.QuillComponent,{content:this.props.content,captureReturn:this.captureReturn,onContentChanged:this.onContentChanged}))}})}APP.BlockTypes.Text="Text",APP.Blocks.H2={Name:"H2",React:H2,Icon:"",Empty:function(){return""},Description:"Heading 2",isEmpty:function(content){return""===content.replace(/(<([^>]+)>)/gi,"")?!0:!1}},window.Kattappa=APP}(window),function(window){var APP=window.Kattappa||{},HR=React.createClass({displayName:"HR",render:function(){return React.createElement("hr",{className:"katap-hr"})}});APP.Blocks.HR={Name:"HR",React:HR,Icon:"",Empty:function(){return""},Description:"Break",isEmpty:function(content){return!0}},window.Kattappa=APP}(window),function(window){var APP=window.Kattappa||{},Droppable=React.createClass({displayName:"Droppable",getInitialState:function(){return{className:""}},getDefaultProps:function(){return{supportClick:!0,multiple:!1}},getClassName:function(){return"katap-droppable "+(this.props.className||this.state.className)},componentDidMount:function(){this.refs.droppable.getDOMNode().focus()},onDragOver:function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy";var effectAllowed=e.dataTransfer.effectAllowed;("all"===effectAllowed||"uninitialized"===effectAllowed)&&this.setState({className:"katap-drop-active"}),this.props.onDragOver&&this.props.onDragOver(e)},onDragLeave:function(e){this.setState({className:""}),this.props.onDragLeave&&this.props.onDragLeave(e)},onClick:function(){var fileInput=React.findDOMNode(this.refs.input);fileInput.value=null,fileInput.click()},onDrop:function(e){e.preventDefault();var files;e.dataTransfer?files=e.dataTransfer.files:e.target&&(files=e.target.files);for(var maxFiles=this.props.multiple?files.length:1,i=0;maxFiles>i;i++)files[i].preview=URL.createObjectURL(files[i]);this.props.onDrop&&(files=Array.prototype.slice.call(files,0,maxFiles),this.props.onDrop(files))},render:function(){return React.createElement("div",{ref:"droppable",className:this.getClassName(),onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onClick:this.onClick,onDrop:this.onDrop},React.createElement("input",{ref:"input",type:"file",style:{display:"none"},multiple:this.props.multiple,onChange:this.onDrop}),this.props.children)}});APP.Droppable=Droppable,window.Kattappa=APP}(window),function(window){var APP=window.Kattappa||{},UploadUrl="",BlockImage=React.createClass({displayName:"BlockImage",getInitialState:function(){return{message:"Drop image here or click to add."}},handleImage:function(files){var self=this,file=files[0];if(0!==file.type.indexOf("image/"))return void alert("Provide a valid image file.");if(""!==APP.Blocks.Image.UploadUrl){var data=new FormData;data.append("image",file),fetch(APP.Blocks.Image.UploadUrl,{method:"POST",credentials:"same-origin",body:data}).then(function(response){if(response.status>=200&&response.status<300)return response.json();var error=new Error(response.statusText);throw error.response=response,error}).then(function(json){json.type&&"success"===json.type?self.props.onContentChanged&&self.props.onContentChanged(self.props.position,json.message):alert("Could not upload.")})["catch"](function(error){console.log(error),alert("Error while uploading. Retry.")})}else this.props.onContentChanged&&this.props.onContentChanged(this.props.position,file.preview)},render:function(){return""===this.props.content?React.createElement("div",{className:"katap-image"},React.createElement(APP.Droppable,{onDrop:this.handleImage},React.createElement("p",null,this.state.message))):React.createElement("div",{className:"katap-image"},React.createElement("img",{src:this.props.content}))}});APP.Blocks.Image={Name:"Image",React:BlockImage,Icon:"",Empty:function(){return""},Description:"Image",UploadUrl:UploadUrl,isEmpty:function(content){return""===content}},window.Kattappa=APP}(window),function(window){var APP=window.Kattappa||{},LI=(APP.Action,React.createClass({displayName:"LI",captureReturn:function(){this.props.addItem(this.props.position)},onContentChanged:function(content){this.props.onContentChanged(this.props.position,content)},render:function(){return React.createElement(APP.QuillComponent,{content:this.props.content,captureReturn:this.captureReturn,onContentChanged:this.onContentChanged})}})),UL=React.createClass({displayName:"UL",onContentChanged:function(position,content){this.props.content[position].content=content,this.props.onContentChanged(this.props.position,this.props.content)},addItem:function(position){if(!(0>position||position>=this.props.content.length)){var content=this.props.content;content.push({content:"",key:APP.uuid()}),this.props.onContentChanged(this.props.position,content)}},handleItemRemove:function(action,position){if(console.log(position),!(this.props.content.length<2)){var content=this.props.content;console.log(content),content.splice(position,1),console.log(content),this.props.onContentChanged(this.props.position,content)}},renderListItem:function(){var self=this,li=[];return this.props.content.map(function(item,index){li.push(React.createElement("li",{key:item.key},React.createElement(APP.BlockControl,{onlyRemove:!0,blockAction:self.handleItemRemove,position:index,length:self.props.content.length}),React.createElement(LI,{position:index,content:item.content,addItem:self.addItem,onContentChanged:self.onContentChanged})))}),li},render:function(){return React.createElement("ul",{className:"katap-list"},this.renderListItem())}});APP.Blocks.UL={Name:"UL",React:UL,Icon:"",Empty:function(){return[{content:"",key:APP.uuid()}]},Description:"Undordered List",isEmpty:function(content){for(var i=0;i<content.length;i++)if(""!==content[i].content.replace(/(<([^>]+)>)/gi,""))return!1;return!0}},window.Kattappa=APP}(window),function(window){var APP=window.Kattappa||{},LI=(APP.Action,React.createClass({displayName:"LI",captureReturn:function(){this.props.addItem(this.props.position)},onContentChanged:function(content){this.props.onContentChanged(this.props.position,content)},render:function(){return React.createElement(APP.QuillComponent,{content:this.props.content,captureReturn:this.captureReturn,onContentChanged:this.onContentChanged})}})),OL=React.createClass({displayName:"OL",onContentChanged:function(position,content){this.props.content[position].content=content,this.props.onContentChanged(this.props.position,this.props.content)},addItem:function(position){if(!(0>position||position>=this.props.content.length)){var content=this.props.content;content.push({content:"",key:APP.uuid()}),this.props.onContentChanged(this.props.position,content)}},handleItemRemove:function(action,position){if(console.log(position),!(this.props.content.length<2)){var content=this.props.content;console.log(content),content.splice(position,1),console.log(content),this.props.onContentChanged(this.props.position,content)}},renderListItem:function(){var self=this,li=[];return this.props.content.map(function(item,index){li.push(React.createElement("li",{key:item.key},React.createElement(APP.BlockControl,{onlyRemove:!0,blockAction:self.handleItemRemove,position:index,length:self.props.content.length}),React.createElement(LI,{position:index,content:item.content,addItem:self.addItem,onContentChanged:self.onContentChanged})))}),li},render:function(){return React.createElement("ol",{className:"katap-list"},this.renderListItem())}});APP.Blocks.OL={Name:"OL",React:OL,Icon:"",Empty:function(){return[{content:"",key:APP.uuid()}]},Description:"Ordered List",isEmpty:function(content){for(var i=0;i<content.length;i++)if(""!==content[i].content.replace(/(<([^>]+)>)/gi,""))return!1;return!0}},window.Kattappa=APP}(window),function(window){function getDomain(url){var a=window.document.createElement("a");return a.href=url,a.hostname}var APP=window.Kattappa||{},urlRegExp=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/i,Embed=React.createClass({displayName:"Embed",getInitialState:function(){return{loaded:!1,domain:"",url:""}},getDefaultProps:function(){return{content:""}},checkUrls:function(url,isProp){if(urlRegExp.test(url)){var domain=getDomain(url);for(var key in APP.Blocks.Embed.Types)if(domain.indexOf(key)>-1)return void this.setState({loaded:!0,domain:key,url:url});alert("This URL is not supported."),this.refs.getDOMNode().value=""}else isProp||alert("Enter a valid url")},handleUrl:function(event){event.keyCode===APP.Keys.ENTER&&this.checkUrls(event.target.value,!1)},componentDidMount:function(){this.refs.input.getDOMNode().focus(),this.checkUrls(this.props.content,!0)},checkContent:function(ok){ok?this.props.onContentChanged(this.props.position,this.state.url):this.props.content===this.state.url||this.setState({loaded:!1})},renderBlock:function(){return React.createElement(APP.Blocks.Embed.Types[this.state.domain],{url:this.state.url,checkContent:this.checkContent})},render:function(){return this.state.loaded?this.renderBlock():React.createElement("div",{className:"katap-embed"},React.createElement("input",{ref:"input",type:"text",placeholder:"Enter URL and press enter",onKeyUp:this.handleUrl}))}});APP.Blocks.Embed={Name:"Embed",React:Embed,Icon:"",Empty:function(){return""},Description:"Embed",isEmpty:function(content){return""===content},Types:{}},window.Kattappa=APP}(window),function(window){var APP=window.Kattappa||{},Types=APP.Blocks.Embed.Types||{},Instagram=React.createClass({displayName:"Instagram",getInitialState:function(){return{message:"Wait",id:"",valid:!1}},getDefaultProps:function(){return{url:"",regex:/https?:\/\/instagram\.com\/p\/([^\/]+)\/?.*/gi}},componentDidMount:function(){this.validate()},validate:function(){var match;return match=this.props.regex.exec(this.props.url),this.props.regex.lastIndex=0,match?(this.setState({message:"OK.",id:match[1],valid:!0}),void this.props.checkContent(!0)):(this.props.checkContent(!1),void this.setState({message:"error."}))},render:function(){return this.state.valid?React.createElement("div",{className:"katap-embed katap-instagram"},React.createElement("iframe",{src:"//instagram.com/p/"+this.state.id+"/embed",frameBorder:0,allowFullScreen:!0})):React.createElement("div",{className:"katap-embed"},"Invalid instagram URL.")}});Types.instagram=Instagram,APP.Blocks.Embed.Types=Types,window.Kattappa=APP}(window),function(window){var APP=window.Kattappa||{},Types=APP.Blocks.Embed.Types||{},Youtube=React.createClass({displayName:"Youtube",getInitialState:function(){return{message:"Wait",id:"",valid:!1}},getDefaultProps:function(){return{url:"",regex:/^.*(?:(?:youtu\.be\/)|(?:youtube\.com)\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*)/}},componentDidMount:function(){this.validate()},validate:function(){var match;return match=this.props.regex.exec(this.props.url),this.props.regex.lastIndex=0,match?(this.setState({message:"OK.",id:match[1],valid:!0}),void this.props.checkContent(!0)):(this.props.checkContent(!1),void this.setState({message:"error."}))},render:function(){return this.state.valid?React.createElement("div",{className:"katap-embed katap-youtube"},React.createElement("iframe",{src:"//youtube.com/embed/"+this.state.id,frameBorder:0,width:580,height:320,allowFullScreen:!0})):React.createElement("div",{className:"katap-embed"},"Invalid youtube URL.")}});Types.youtu=Youtube,APP.Blocks.Embed.Types=Types,window.Kattappa=APP}(window),function(window){var APP=window.Kattappa||{},Types=APP.Blocks.Embed.Types||{},Vimeo=React.createClass({displayName:"Vimeo",getInitialState:function(){return{message:"Wait",id:"",valid:!1}},getDefaultProps:function(){return{url:"",regex:/(?:http[s]?:\/\/)?(?:www.)?vimeo\.co(?:.+(?:\/)([^\/].*)+$)/}},componentDidMount:function(){this.validate()},validate:function(){var match;return match=this.props.regex.exec(this.props.url),this.props.regex.lastIndex=0,match?(this.setState({message:"OK.",id:match[1],valid:!0}),void this.props.checkContent(!0)):(this.props.checkContent(!1),void this.setState({message:"error."}))},render:function(){return this.state.valid?React.createElement("div",{className:"katap-embed katap-vimeo"},React.createElement("iframe",{src:"//player.vimeo.com/video/"+this.state.id,frameBorder:0,width:580,height:320,allowFullScreen:!0})):React.createElement("div",{className:"katap-embed"},"Invalid vimeo URL.")}});Types.vimeo=Vimeo,APP.Blocks.Embed.Types=Types,window.Kattappa=APP}(window),function(window){var APP=window.Kattappa||{},Action=APP.Action,blocks=APP.Blocks,Toolbar=React.createClass({displayName:"Toolbar",getInitialState:function(){return{visible:!1,types:Object.keys(blocks)}},toggleState:function(e){var nodes=Array.prototype.slice.call(e.currentTarget.children),index=nodes.indexOf(e.target);0>index||(this.setState({visible:!this.state.visible}),this.state.visible&&0!==index&&this.props.addBlock(nodes[index].getAttribute("title"),this.props.position))},addBlock:function(type,position){this.props.addBlock()},render:function(){return this.state.visible?React.createElement("div",{className:"katap-toolbar",onClick:this.toggleState},React.createElement("button",{title:"Close"},"×"),this.state.types.map(function(typ,pos){return React.createElement("button",{title:typ,key:pos},blocks[typ].Description)})):React.createElement("div",{className:"katap-toolbar",onClick:this.toggleState},React.createElement("button",{title:"Add block"},"+"))}}),BlockControl=React.createClass({displayName:"BlockControl",getDefaultProps:function(){},handleClick:function(e){var nodes=Array.prototype.slice.call(e.currentTarget.children),index=nodes.indexOf(e.target);if(!(0>index)){var action=nodes[index].getAttribute("data-action");this.props.blockAction(action,this.props.position)}},getToolbar:function(index){if(this.props.onlyRemove)return React.createElement("div",{className:"katap-control-toolbar",onClick:this.handleClick},React.createElement("button",{title:"Remove","data-action":Action.REMOVE,key:Action.REMOVE},"×"));var buttons=[];return 0===index&&this.props.length<2?buttons.push(React.createElement("button",{title:"Remove","data-action":Action.REMOVE,key:Action.REMOVE},"×")):0===index?(buttons.push(React.createElement("button",{title:"Remove","data-action":Action.REMOVE,key:Action.REMOVE},"×")),buttons.push(React.createElement("button",{title:"Move Down","data-action":Action.DOWN,key:Action.DOWN},"↓"))):index===this.props.length-1?(buttons.push(React.createElement("button",{title:"Remove","data-action":Action.REMOVE,key:Action.REMOVE},"×")),buttons.push(React.createElement("button",{title:"Move Up","data-action":Action.UP,key:Action.UP},"↑"))):(buttons.push(React.createElement("button",{title:"Remove","data-action":Action.REMOVE,key:Action.REMOVE},"×")),buttons.push(React.createElement("button",{title:"Move Up","data-action":Action.UP,key:Action.UP},"↑")),buttons.push(React.createElement("button",{title:"Move Down","data-action":Action.DOWN,key:Action.DOWN},"↓"))),React.createElement("div",{className:"katap-control-toolbar",onClick:this.handleClick},buttons)},render:function(){return this.getToolbar(this.props.position)}});APP.Toolbar=Toolbar,APP.BlockControl=BlockControl,window.Kattappa=APP}(window),function(window){var APP=window.Kattappa||{},ExtraEnter=(React.PropTypes,"<div><br></div>");if(React.cloneElement){React.cloneElement}else{if(!React.addons||!React.addons.cloneWithProps)throw new Error("React addons are required when using React 0.12 or less.");{React.addons.cloneWithProps}}var defaultItems=[{label:"Text",type:"group",items:[{type:"bold",label:"Bold"},{type:"italic",label:"Italic"},{type:"link",label:"Link"}]}],QuillComponent=React.createClass({displayName:"QuillComponent",onConvert:function(c){console.log(c),console.log(c.replace(/(<([^>]+)>)/gi,""))},getDefaultProps:function(){return{className:"ql-editor",theme:"base",modules:{"link-tooltip":!0},content:""}},enterPressed:function(){this.props.enterPressed&&this.props.enterPressed()},getInitialState:function(){return{showToolbar:!0}},createEditor:function($el,config){var editor=new Quill($el,config);return this.hookEditor(editor),editor},hookEditor:function(editor){editor.on("text-change",function(delta,source){this.onEditorChange&&this.onEditorChange(editor.getHTML(),delta,source)}.bind(this)),editor.on("selection-change",function(range,source){this.onEditorChangeSelection&&this.onEditorChangeSelection(range,source)}.bind(this)),editor.addModule("enterHandler",{keydown:this.captureReturn}),this.setEditorContents(editor,this.props.content)},focus:function(){this.state.editor.focus()},onEditorChange:function(value,delta,source){value.indexOf(ExtraEnter)>0&&(value=value.replace(ExtraEnter,""),this.state.editor.setHTML(value),this.state.editor.setSelection(1,1)),this.props.onContentChanged&&this.props.onContentChanged(value)},captureReturn:function(){this.props.captureReturn&&this.props.captureReturn()},getEditorContents:function(){return this.state.content},setEditorContents:function(editor,value){var sel=editor.getSelection();editor.setHTML(value),sel&&this.setEditorSelection(editor,sel)},isControlled:function(){return"value"in this.props},getEditorConfig:function(){var config={theme:this.props.theme,modules:this.props.modules,pollInterval:this.props.pollInterval,formats:["bold","italic","link"]};return config.modules.toolbar||(config.modules=JSON.parse(JSON.stringify(config.modules)),config.modules.toolbar={container:this.refs.toolbar.getDOMNode()}),config},getEditorElement:function(){return this.refs.editor.getDOMNode()},componentDidMount:function(){var editor=this.createEditor(this.getEditorElement(),this.getEditorConfig());this.setState({editor:editor}),editor.focus(),editor.setHTML(this.props.content)},renderItems:function(item,index){return React.createElement("span",{className:"ql-format-button ql-"+item.type,title:item.label,key:index})},renderGroups:function(){var self=this,items=this.props.items||defaultItems,groups=items.map(function(item,index){return React.createElement("span",{className:"ql-format-"+item.type,key:index},item.items.map(self.renderItems))});return groups},render:function(){var visibility=this.state.showToolbar?"visible":"hidden",self=this;return React.createElement("div",{className:"quill-rte"},React.createElement("div",{ref:"toolbar",className:"ql-toolbar ql-snow",style:{visibility:visibility}},self.renderGroups()),React.createElement("div",{className:"ql-container ql-snow",ref:"editor"}))}});APP.QuillComponent=QuillComponent,window.Kattappa=APP}(window),function(window){var APP=window.Kattappa||{},Medium=(React.PropTypes,window.Medium);if(React.cloneElement){React.cloneElement}else{if(!React.addons||!React.addons.cloneWithProps)throw new Error("React addons are required when using React 0.12 or less.");{React.addons.cloneWithProps}}var defaultItems=[{label:"Text",type:"group",items:[{type:"bold",label:"Bold"},{type:"italic",label:"Italic"},{type:"link",label:"Link"}]}],MediumComponent=React.createClass({displayName:"MediumComponent",onConvert:function(c){console.log(c),console.log(c.replace(/(<([^>]+)>)/gi,""))},getDefaultProps:function(){return{className:"katap-medium-editor",theme:"base",modules:{"link-tooltip":!0},content:""}},enterPressed:function(){console.log(this.editor.getSelection()),this.props.enterPressed&&this.props.enterPressed()},getInitialState:function(){return{showToolbar:!0}},createEditor:function($el,config){var editor=new Medium(this.getEditorConfig());return editor},hookEditor:function(editor){editor.on("text-change",function(delta,source){this.onEditorChange&&this.onEditorChange(editor.getHTML(),delta,source)}.bind(this)),editor.on("selection-change",function(range,source){this.onEditorChangeSelection&&this.onEditorChangeSelection(range,source)}.bind(this)),editor.addModule("enterHandler",{keydown:this.captureReturn}),this.setEditorContents(editor,this.props.content)},focus:function(){this.state.editor.focus()},onEditorChange:function(value,delta,source){value.indexOf(ExtraEnter)>0&&(value=value.replace(ExtraEnter,""),this.state.editor.setHTML(value),this.state.editor.setSelection(1,1)),this.props.onContentChanged&&this.props.onContentChanged(value)},captureReturn:function(){this.props.captureReturn&&this.props.captureReturn()},getEditorContents:function(){return this.state.content},setEditorContents:function(editor,value){var sel=editor.getSelection();editor.setHTML(value),sel&&this.setEditorSelection(editor,sel)},isControlled:function(){return"value"in this.props},getEditorConfig:function(){var config={element:this.getEditorElement(),mode:Medium.inlineRichMode,tags:{innerLevel:["a","b","i"],"break":"br",horizontalRule:"hr",paragraph:"p"},cssClasses:{editor:"Medium",pasteHook:"Medium-paste-hook",placeholder:"Medium-placeholder",clear:"Medium-clear"},attributes:{remove:["style","class"]},pasteAsText:!1};return config},getEditorElement:function(){return this.refs.editor.getDOMNode()},componentDidMount:function(){var editor=this.createEditor(this.getEditorConfig());this.setState({editor:editor}),editor.focus(),console.log(editor)},renderItems:function(item,index){return React.createElement("span",{className:"ql-format-button ql-"+item.type,title:item.label,key:index})},renderGroups:function(){var self=this,items=this.props.items||defaultItems,groups=items.map(function(item,index){return React.createElement("span",{className:"ql-format-"+item.type,key:index},item.items.map(self.renderItems))});return groups},render:function(){var visibility="visible",self=this;return React.createElement("div",{className:"katap-medium-rte"},React.createElement("div",{ref:"toolbar",className:"katap-medium-toolbar",style:{visibility:visibility}},self.renderGroups()),React.createElement("div",{className:"katap-medium-container",ref:"editor"}))}});APP.MediumComponent=MediumComponent,window.Kattappa=APP}(window),function(window){var APP=window.Kattappa||{},initialState={blocks:[]},Action=APP.Action,Editor=React.createClass({displayName:"Editor",getInitialState:function(){return initialState},getDefaultProps:function(){return{blockUrl:""}},componentDidMount:function(){var self=this;""!==this.props.blockUrl&&fetch(self.props.blockUrl,{credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){if(response.status>=200&&response.status<300)return response.json();var error=new Error(response.statusText);throw error.response=response,error}).then(function(json){self.props.processData?self.setState({blocks:self.props.processData(json)}):console.warn("Provide a function to process blocks.")})["catch"](function(e){console.error(e)})},handleBlockAction:function(action,position){var newBlocks=this.state.blocks;if(action===Action.REMOVE){if(!APP.Blocks[newBlocks[position].type].isEmpty(newBlocks[position].content)&&!confirm("Sure?"))return;newBlocks.splice(position,1)}else action===Action.UP?newBlocks.splice(position-1,2,newBlocks[position],newBlocks[position-1]):action===Action.DOWN&&newBlocks.splice(position,2,newBlocks[position+1],newBlocks[position]);this.setState({blocks:newBlocks})},addBlock:function(type,position){if(!(0>position||position>this.state.blocks.length)){var newBlock={type:type,content:APP.Blocks[type].Empty(),key:APP.uuid()},newBlocks=this.state.blocks;newBlocks.splice(position+1,0,newBlock),this.setState({blocks:newBlocks})}},contentChange:function(position,content){var newBlocks=this.state.blocks;newBlocks[position].content=content,this.setState({blocks:newBlocks})},getToolbar:function(index){return React.createElement(APP.BlockControl,{blockAction:this.handleBlockAction,position:index,length:this.state.blocks.length})},renderBlocks:function(){var self=this,blocks=this.props.blocks||this.state.blocks;if(blocks.length<1)return React.createElement(APP.Toolbar,{position:0,addBlock:this.addBlock});var rndr=blocks.map(function(block,index){return React.createElement("div",{key:block.key,className:"katap-container"},self.getToolbar(index),React.createElement(APP.Blocks[block.type].React,{ref:"block"+index,position:index,content:block.content,addBlock:self.addBlock,onContentChanged:self.contentChange}),React.createElement(APP.Toolbar,{position:index,addBlock:self.addBlock}))});return rndr},passBlocks:function(){this.props.onSave&&this.props.onSave(this.state.blocks)},render:function(){return this.state.blocks.length>0?React.createElement("div",{className:"katap-listing"},React.createElement("button",{onClick:this.passBlocks,className:"katap-savebtn"},"Save"),this.renderBlocks()):React.createElement("div",{className:"katap-listing"},this.renderBlocks())}});APP.Editor=Editor,window.Kattappa=APP}(window);
//# sourceMappingURL=maps/kattappa.js.map